(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-43df26c1"],{"0e8f":function(e,t,a){"use strict";a("20f6");var o=a("e8f2");t["a"]=Object(o["a"])("flex")},"305c":function(e,t,a){"use strict";a.r(t);var o=a("c6a6"),i=a("8336"),s=a("62ad"),n=a("a523"),r=a("8fea"),l=a("23a7"),c=a("0e8f"),d=a("132d"),u=a("0fd9"),p=a("b974"),m=a("1f4f"),h=a("71a3"),_=a("c671"),g=a("fe57"),f=a("8654"),b=(a("e9f5"),a("910d"),function(){var e=this,t=e._self._c;return t("div",[t(n["a"],{attrs:{fluid:""}},[t(s["a"],{attrs:{md:"12",cols:"12"}},["nuevo"==e.tipo?t("h1",[e._v("MONTO A COBRAR :"+e._s(e.symbol)+" "+e._s(e.total))]):t("h1",[e._v("MONTO TOTAL : "+e._s(e.totalPagado))])]),t(g["a"],{attrs:{color:"#A43542","slider-color":"primary","fixed-tabs":""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[t(h["a"],{attrs:{href:"#ref1"}},[e._v("STEP 1")]),t(h["a"],{attrs:{href:"#ref2",disabled:e.step2}},[e._v("STEP 2")]),t(_["a"],{attrs:{value:"ref1"}},[t(u["a"],{staticClass:"mt-5"},[t(s["a"],{attrs:{md:"4",cols:"4"}},[t(o["a"],{attrs:{items:e.clientes,"item-text":"namelong","item-value":"id",label:"Cliente","return-object":"",clearable:"",readonly:"ver"==e.tipo},on:{change:function(t){return e.obtenerListado()}},model:{value:e.id_proveedor,callback:function(t){e.id_proveedor=t},expression:"id_proveedor"}})],1),e.$store.state.listPagosXProveedorCxP.length>0?t(s["a"],{attrs:{md:"12",cols:"12"}},[t(r["a"],{attrs:{headers:e.headers,items:e.listPagosXProveedorCxP,"show-select":""},on:{"item-selected":e.validarAprobacion},scopedSlots:e._u([{key:"item.moneda",fn:function({item:a}){return[t(o["a"],{attrs:{items:e.$store.state.itemsCoinsList,"item-text":"acronym","item-value":"id",label:"Moneda",disabled:0==e.selected.filter(e=>e.id==a.id).length},model:{value:e.id_coins,callback:function(t){e.id_coins=t},expression:"id_coins"}})]}},{key:"item.montopagar",fn:function({item:a}){return[t(f["a"],{attrs:{prefix:e.symbol,type:"number",max:a.montopagar,disabled:0==e.selected.filter(e=>e.index==a.index).length,"error-messages":a.err},on:{blur:function(t){return e.calcularTotal()}},nativeOn:{focus:function(t){return e.calcularTotal()}},model:{value:a.montopagar,callback:function(t){e.$set(a,"montopagar",t)},expression:"item.montopagar"}})]}},{key:"item.maxpagar",fn:function({item:t}){return[e._v(" "+e._s(t.symbol)+" "+e._s(t.max_pagar)+" ")]}},{key:"item.tipocambio",fn:function({item:a}){return[t(f["a"],{attrs:{type:"number",disabled:0==e.selected.filter(e=>e.index==a.index).length},on:{blur:function(t){return e.calcularMonto()}},nativeOn:{focus:function(t){return e.calcularMonto()}},model:{value:a.tipocambio,callback:function(t){e.$set(a,"tipocambio",t)},expression:"item.tipocambio"}})]}}],null,!0),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})],1):e._e(),e.$store.state.listPagosXProveedorCxP.length>0?t(s["a"],{attrs:{md:"12",cols:"12"}},["nuevo"==e.tipo?t(c["a"],{attrs:{"text-right":""}},[t(i["a"],{attrs:{color:"success"},on:{click:function(t){return e.continuar()}}},[e._v(" Continuar ")])],1):e._e()],1):e._e()],1)],1),t(_["a"],{attrs:{value:"ref2"}},[t(u["a"],{staticClass:"mt-5"},[t(s["a"],{attrs:{md:"4",cols:"4"}},["nuevo"==e.tipo?t(f["a"],{attrs:{label:"Nro Operacion",id:"nro_operacion","error-messages":e.errorNroOperacion,"success-messages":e.successMessages},on:{blur:function(t){return e.ValidateNroOperacion()}},model:{value:e.nro_operacion,callback:function(t){e.nro_operacion=t},expression:"nro_operacion"}}):e._e()],1),t(s["a"],{attrs:{cols:"4",md:"4"}},[t(f["a"],{attrs:{type:"date",label:"Fecha "},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}})],1),"nuevo"==e.tipo?t(s["a"],{attrs:{md:"6",cols:"6"}},[t(c["a"],[t(l["a"],{attrs:{label:"Cargar Archivo","show-size":"","truncate-length":"50","hide-details":""},on:{change:function(t){return e._uploadFile()}},model:{value:e.payfile,callback:function(t){e.payfile=t},expression:"payfile"}})],1)],1):e._e(),"nuevo"!=e.tipo?t(s["a"],{attrs:{md:"6"}},[t("h6",[e._v("DOCUMENTO:")]),t(m["a"],[t("tbody",[t("tr",[t("td",[e._v(e._s(e.name_path))]),t("td",[t(i["a"],{attrs:{icon:"",color:"red",href:e.url_documento,target:"_blank"}},[t(d["a"],[e._v("mdi-file-pdf-box")])],1)],1)])])])],1):e._e(),t(s["a"],{attrs:{md:"4",cols:"4"}},[t(o["a"],{attrs:{items:(e.cuentas||[]).filter(t=>t.symbol==e.symbol),"item-text":"label","item-value":"id",label:"Cuenta Destino (PIC)","return-object":"",readonly:"ver"==e.tipo},model:{value:e.id_cuenta,callback:function(t){e.id_cuenta=t},expression:"id_cuenta"}})],1),t(s["a"],{attrs:{md:"4",cols:"4"}},["nuevo"==e.tipo?t(f["a"],{attrs:{readonly:"",label:"Banco:"},model:{value:e.id_cuenta.banco,callback:function(t){e.$set(e.id_cuenta,"banco",t)},expression:"id_cuenta.banco"}}):e._e()],1),t(s["a"],{attrs:{md:"4",cols:"4"}},["nuevo"==e.tipo?t(f["a"],{attrs:{readonly:"",label:"Moneda:"},model:{value:e.id_cuenta.moneda,callback:function(t){e.$set(e.id_cuenta,"moneda",t)},expression:"id_cuenta.moneda"}}):e._e()],1),t(s["a"],{attrs:{md:"4",cols:"4"}},["nuevo"==e.tipo?t(f["a"],{attrs:{readonly:"",label:"N° Cuenta:"},model:{value:e.id_cuenta.cuenta,callback:function(t){e.$set(e.id_cuenta,"cuenta",t)},expression:"id_cuenta.cuenta"}}):e._e()],1),t(s["a"],{attrs:{md:"4",cols:"4"}},[t(p["a"],{attrs:{items:e.$store.state.itemsDataBanksList,label:"Banco Origen","item-text":"acronym","item-value":"id"},model:{value:e.id_banco_origen,callback:function(t){e.id_banco_origen=t},expression:"id_banco_origen"}})],1),"nuevo"==e.tipo?t(s["a"],{attrs:{md:"12",cols:"12"}},[t(c["a"],{attrs:{"text-right":""}},[t(i["a"],{attrs:{loading:e.loading,disabled:!e.id_cuenta.id||!e.nro_operacion||!e.id_banco_origen,color:"success"},on:{click:function(t){return e._putPayForProveedor()}}},[e._v(" PROCESAR PAGO ")])],1)],1):e._e()],1)],1)],1)],1)],1)}),v=[],P=(a("7d54"),a("bc3a")),x=a.n(P),y=a("3d20"),C=a.n(y),k=a("2f62"),O={props:["tipo"],data(){return{errorNroOperacion:"",loading:!1,date:"",payfile:[],selected:[],id_coins:"",payPath:"",id_proveedor:"",boolFile:!1,cuentas:[],id_cuenta:"",itemsClientes:[],tab:null,total:0,step2:!0,name_path:"",url_documento:"",totalPagado:0,nro_operacion:"",id_banco_origen:"",successMessages:"",headers:[{text:"Fecha",value:"fecha"},{text:"House",value:"codigo_house"},{text:"Cliente Pagó",value:"statuspago"},{text:"Monto Dolar",value:"monto_pagar"},{text:"Monto Moneda Banco",value:"maxpagar"},{text:"Moneda",value:"moneda"},{text:"Tipo Cambio",value:"tipocambio"},{text:"Pago Parcial",value:"montopagar"}]}},async mounted(){let e=this;e.$store.state.spiner=!0,await e._getBanksList(),await e.cargarClientes(),await e.obtenerListado(),await e.getListBanksDetailsCargar(),await e.getListBanksDetailsCargar(),await e.limpiarDatos(),await e.obtenerDatos(),await e._getCoinsList(),e.$store.state.spiner=!1},methods:{...Object(k["b"])(["_getListaPagosXProveedorCxC","getListBanksDetailsCargar","_getCoinsList","cargarClientes","_getBanksList","validateNroOperacion"]),validarAprobacion(e){e.value},async ValidateNroOperacion(){this.errorNroOperacion="",this.successMessages="";let e={nro_operacion:this.nro_operacion,id_branch:JSON.parse(sessionStorage.getItem("dataUser"))[0].id_branch},t=await this.validateNroOperacion(e);t.estadoflag&&(this.errorNroOperacion=t.mensaje,document.getElementById("nro_operacion").focus()),t.mensaje&&(this.successMessages="Existen Operaciones con Nro(s) Similiares: "+t.mensaje)},async obtenerListado(){this.$store.state.listPagosXProveedorCxP.listPagosXProveedorCxP=[],this.date="",this.payfile=[],this.boolFile=!1,this.id_cuenta="",this.id_banco_origen="",this.nro_operacion="",this.id_proveedor.id&&"nuevo"==this.tipo?await this._getListaPagosXProveedorCxC(this.id_proveedor.id):this.selected=[]},async getListBanksDetailsCargar(){let e=this;var t={method:"get",url:"https://api.agentedecargaonline.com/getListBanksDetailsCargar",params:{id_branch:JSON.parse(sessionStorage.getItem("dataUser"))[0].id_branch},headers:{"auth-token":sessionStorage.getItem("auth-token"),"Content-Type":"application/json"}};await x()(t).then((function(t){e.cuentas=t.data.data})).catch((function(e){console.log(e)}))},validarMonto(e){parseFloat(e.max_pagar)<parseFloat(e.monto_deuda)?document.getElementById("pago"+e.id).focus():this.calcularTotal()},calcularMonto(){this.selected.length>0&&(this.selected.forEach(e=>{console.log(e),this.id_coins=e.id_coins,this.symbol=this.$store.state.itemsCoinsList.filter(e=>e.id==this.selected[0].id_coins)[0].symbol,e.montopagar=parseFloat(e.monto_deuda).toFixed(2),e.montopagar>e.max_pagar?e.err="Monto Superior a la deuda ":e.err=""}),this.calcularTotal())},calcularTotal(){let e=0;this.selected.forEach(t=>{e+=parseFloat(t.montopagar)}),this.total=parseFloat(e).toFixed(2)},_uploadFile(){var e=a("5a30"),t=(a("3e8f"),new e),o=this;t.append("name","Prueba"),t.append("file",o.payfile);var i={method:"post",url:"https://api.agentedecargaonline.com/uploadAllPath",headers:{"auth-token":sessionStorage.getItem("auth-token"),"Content-Type":"application/json"},data:t};x()(i).then((function(e){o.boolFile=!0,o.payPath=JSON.stringify(e.data.data[0].insertid)})).catch((function(e){console.log(e)}))},validar(e=!1){let t=!0,a="";return this.listPagosXProveedorCxP.forEach(e=>{let o=0;o=parseFloat(e.monto_deuda).toFixed(2);let i=0;i=parseFloat(e.max_pagar).toFixed(2),parseFloat(o)>parseFloat(i)&&(t=!1,a="No puede realizar un pago mayor a la deuda. ")}),!this.id_cuenta&&e&&(t=!1,a+="Por favor, seleccione una cuenta. "),0==this.selected.length&&(t=!1,a+="Seleccione al menos una cuenta a pagar. "),t||this.$swal({icon:"error",title:"Lo sentimos",text:a}),t},async _putPayForProveedor(){if(0==this.payPath||!this.payPath)return C.a.fire({icon:"warning",title:"Soporte de Pago",text:"SE SUGIERE GUARDAR EL SOPORTE DE PAGO POR FAVOR ANEXARLO",confirmButtonText:"Continuar, sin soporte",cancelButtonText:"Cancelar",showDenyButton:!1,allowEnterKey:!1,allowOutsideClick:!1,allowEscapeKey:!1,showCancelButton:!0,cancelButtonColor:"#B71C1C"}).then(e=>{e.isConfirmed&&this.procesarPago()}),!1;this.procesarPago()},async procesarPago(){try{if(this.validar(!0)){let a=this;a.loading=!0;var e={id_proveedor:a.id_proveedor.id,id_path:a.payPath,details:a.selected,id_cuenta:a.id_cuenta.id,fecha:a.date,nro_operacion:a.nro_operacion,id_banco_origen:a.id_banco_origen,id_coins:a.id_coins},t={method:"post",url:"https://api.agentedecargaonline.com/setPayForCustomer",headers:{"auth-token":sessionStorage.getItem("auth-token"),"Content-Type":"application/json"},data:e};await x()(t).then((function(e){1==e.data.statusBol&&(a.$swal({icon:"success",title:"Aviso",text:e.data.data[0].mensaje}).then(e=>{e.isConfirmed}),a.limpiarDatos())})).catch((function(e){console.log(e)})),this.loading=!1}}catch(a){console.log(a)}},continuar(){this.validar()&&(this.step2=!1,this.tab="ref2")},limpiarDatos(){this.payfile=[],this.payPath="",this.id_proveedor="",this.selected=[],this.boolFile=!1,this.tab="ref1",this.step2=!0,this.total=0,this.$store.state.listPagosXProveedorCxP=[]},async obtenerDatos(){if("ver"==this.tipo){let t=this,a=t.$route.params.id;var e={method:"get",url:"https://api.agentedecargaonline.com/getVerPagosPorCustomer?id="+a,headers:{"auth-token":sessionStorage.getItem("auth-token"),"Content-Type":"application/json"}};await x()(e).then((function(e){t.step2=!1,t.id_proveedor=data.id_proveedor,t.$store.state.listPagosXProveedorCxP=data.details,t.id_cuenta=data.id_bank,t.name_path=data.documento,t.url_documento=data.link_documento,setTimeout(()=>{t.calcularTotalPagado()},200)})).catch((function(e){console.log(e)}))}}},computed:{...Object(k["c"])(["itemsProveedorList","listPagosXProveedorCxP","clientes"]),symbol(){let e="";return this.id_coins&&(e=this.$store.state.itemsCoinsList.filter(e=>e.id==this.id_coins)[0].symbol),e}},watch:{selected(){this.calcularMonto()}}},w=O,F=a("2877"),L=Object(F["a"])(w,b,v,!1,null,null,null);t["default"]=L.exports}}]);