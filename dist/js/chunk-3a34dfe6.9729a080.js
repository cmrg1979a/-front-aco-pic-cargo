(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3a34dfe6"],{6681:function(t,e,o){"use strict";o("a914")},a914:function(t,e,o){},d2a1:function(t,e,o){"use strict";o.r(e);var a=o("c6a6"),i=o("8336"),s=o("b0af"),r=o("99d9"),n=o("62ad"),l=o("a523"),c=o("8fea"),d=o("169a"),m=o("4bd4"),u=o("132d"),p=o("0fd9"),h=o("b974"),_=o("2fa4"),v=o("8654"),f=o("a844"),x=(o("e9f5"),o("910d"),function(){var t=this,e=t._self._c;return e(l["a"],{attrs:{fluid:""}},[e(s["a"],[e(r["d"],[t._v(" Datos Principales: "),e(_["a"]),e("b",{style:{fontSize:t.textSize}},[t._v(t._s(t.totalfinal)+" USD")])],1),e(r["c"],[e(n["a"],{attrs:{cols:"12"}},[e(m["a"],{ref:"frmProyeccion"},[e(p["a"],[e(n["a"],{attrs:{cols:"12",md:"2"}},[e(h["a"],{attrs:{items:t.$store.state.month,label:"Mes",dense:"","item-text":"description","item-value":"id",rules:[t=>!!t||"Dato requerido"]},model:{value:t.id_month,callback:function(e){t.id_month=e},expression:"id_month"}})],1),e(n["a"],{attrs:{cols:"12",md:"2"}},[e(h["a"],{attrs:{items:t.$store.state.year,label:"Año",dense:"","item-text":"description","item-value":"id",rules:[t=>!!t||"Dato requerido"]},model:{value:t.id_year,callback:function(e){t.id_year=e},expression:"id_year"}})],1),e(n["a"],{attrs:{cols:"12",md:"2"}},[e(v["a"],{attrs:{label:"Tipo Cambio",dense:"",rules:[t=>!!t||"Dato requerido"]},on:{blur:function(e){return t.calcularTotalTipoCambio()}},model:{value:t.tipocambio,callback:function(e){t.tipocambio=e},expression:"tipocambio"}})],1),e(n["a"],{attrs:{cols:"12",md:"3"}},[e(v["a"],{attrs:{label:`Total Proyectado(${t.monExt})`,dense:"",readonly:""},model:{value:t.totalmonlocal,callback:function(e){t.totalmonlocal=e},expression:"totalmonlocal"}})],1),e(n["a"],{attrs:{cols:"12",md:"3"}},[e(v["a"],{attrs:{label:"Conversión a Dolares(USD)",dense:"",readonly:""},model:{value:t.montoconversiondolar,callback:function(e){t.montoconversiondolar=e},expression:"montoconversiondolar"}})],1),e(n["a"],{attrs:{cols:"12",md:"3","offset-md":"9"}},[e(v["a"],{attrs:{label:"Gastos(USD)",dense:"",readonly:""},model:{value:t.totaldolar,callback:function(e){t.totaldolar=e},expression:"totaldolar"}})],1),e(n["a"],{attrs:{cols:"12",md:"3","offset-md":"9"}},[e(v["a"],{attrs:{label:`Total Proyectado(${t.monExt})`,dense:"",readonly:""},model:{value:t.totalfinal,callback:function(e){t.totalfinal=e},expression:"totalfinal"}})],1)],1)],1)],1),e(n["a"],[e(i["a"],{staticClass:"mx-1",attrs:{small:"",color:"info",rounded:""},on:{click:function(e){return t.agregarFilaNueva()}}},[t._v("Añadir Detalle")])],1),t.tipocambio?e(n["a"],{attrs:{cols:"12"}},[e(c["a"],{staticClass:"elevation-1",attrs:{headers:t.headers,items:t.items.filter(t=>!!t.estado),"pagination.sync":"pagination","item-key":"index",loading:"true","disable-sort":""},scopedSlots:t._u([{key:"item.gasto",fn:function({item:o}){return[e(h["a"],{attrs:{items:t.$store.state.balances.tipogastos.filter(t=>0!=t.id),placeholder:"Tipo de Gasto",dense:"","item-text":"description","item-value":"id","error-messages":o.errgasto},model:{value:o.id_gasto,callback:function(e){t.$set(o,"id_gasto",e)},expression:"item.id_gasto"}})]}},{key:"item.subgasto",fn:function({item:o}){return[e(h["a"],{attrs:{items:t.$store.state.balances.tiposubgastos.filter(t=>t.id_gasto==o.id_gasto),placeholder:"Tipo de SubGasto","item-text":"description","item-value":"id"},model:{value:o.id_tiposubgasto,callback:function(e){t.$set(o,"id_tiposubgasto",e)},expression:"item.id_tiposubgasto"}})]}},{key:"item.proveedor",fn:function({item:o}){return[e(a["a"],{attrs:{items:t.$store.state.provedores,"item-text":"namelong",placeholder:"Proveedor","item-value":"id",dense:"","error-messages":o.errproveedor},model:{value:o.id_entitie,callback:function(e){t.$set(o,"id_entitie",e)},expression:"item.id_entitie"}})]}},{key:"item.descripcion",fn:function({item:o}){return[e(f["a"],{attrs:{dense:"",placeholder:"Descripcion",rows:"1"},model:{value:o.description,callback:function(e){t.$set(o,"description",e)},expression:"item.description"}})]}},{key:"item.montomonoriginal",fn:function({item:o}){return[e(v["a"],{attrs:{placeholder:"Monto Moneda Local",type:"number","error-messages":o.errmontomonoriginal},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.agregarFila(o)},blur:function(e){return t.calcularMontoFinal(o)}},model:{value:o.monto_monlocal,callback:function(e){t.$set(o,"monto_monlocal",e)},expression:"item.monto_monlocal"}})]}},{key:"item.moneda",fn:function({item:o}){return[e(h["a"],{attrs:{items:t.$store.state.itemsCoinsList,"item-text":"symbol",label:"Moneda","item-value":"id","error-messages":o.errmoneda},on:{change:function(e){return t.calcularMontoFinal(o)}},model:{value:o.id_coin,callback:function(e){t.$set(o,"id_coin",e)},expression:"item.id_coin"}})]}},{key:"item.montofinaldolar",fn:function({item:e}){return[t._v(" "+t._s(e.monto_monext)+" ")]}},{key:"item.action",fn:function({item:o}){return[e(i["a"],{attrs:{icon:"",color:"red",dark:""},on:{click:function(e){return t.eliminarfila(o)}}},[e(u["a"],[t._v("mdi-delete")])],1)]}},{key:"item.diavencimiento",fn:function({item:o}){return[e(h["a"],{attrs:{items:t.dias,label:"Día de vencimiento","error-messages":o.errrnodias},model:{value:o.nrodias,callback:function(e){t.$set(o,"nrodias",e)},expression:"item.nrodias"}})]}}],null,!0)})],1):t._e()],1)],1),e(r["a"],[e(_["a"]),t.aprobado?t._e():e(i["a"],{staticClass:"mx-1",attrs:{small:"",color:"success",rounded:""},on:{click:function(e){return t.seleccionEditar()}}},[t._v("Guardar")]),t.aprobado?t._e():e(i["a"],{staticClass:"mx-1",attrs:{small:"",color:"info",rounded:""},on:{click:function(e){return t.validateAprobacion()}}},[t._v("APROBAR")]),e(i["a"],{staticClass:"mx-1",attrs:{small:"",dark:"",color:"red",rounded:""},on:{click:function(e){return t.volver()}}},[t._v("Cancelar")])],1),e(d["a"],{attrs:{persistent:"",overlay:!1,"max-width":"30%"},model:{value:t.dialogn,callback:function(e){t.dialogn=e},expression:"dialogn"}},[e(s["a"],[e(r["d"],{attrs:{"primary-title":""}},[t._v(" REALIZAR COPIA "),e(_["a"]),e(i["a"],{attrs:{icon:"",color:"defaul"},on:{click:function(e){t.dialogn=!t.dialogn}}},[e(u["a"],[t._v("mdi-close")])],1)],1),e(r["c"],[e(p["a"],[e(n["a"],{attrs:{cols:"12"}},[e(h["a"],{attrs:{items:t.$store.state.month,label:"Mes",dense:"","item-text":"description","item-value":"id",rules:[t=>!!t||"Dato requerido"]},model:{value:t.id_monthn,callback:function(e){t.id_monthn=e},expression:"id_monthn"}})],1),e(n["a"],{attrs:{cols:"12"}},[e(h["a"],{attrs:{items:t.$store.state.year,label:"Año",dense:"","item-text":"description","item-value":"id",rules:[t=>!!t||"Dato requerido"]},model:{value:t.id_yearn,callback:function(e){t.id_yearn=e},expression:"id_yearn"}})],1)],1)],1),e(r["a"],[e(_["a"]),e(i["a"],{staticClass:"mx-1",attrs:{color:"success",loading:t.loading},on:{click:function(e){return t.copyProyeccion()}}},[t._v("Copiar")]),e(i["a"],{staticClass:"mx-1",attrs:{color:"red",dark:""},on:{click:function(e){t.dialogn=!t.dialogn}}},[t._v("Cancelar")])],1)],1)],1)],1)}),g=[],y=(o("14d9"),o("7d54"),o("2f62")),b=o("3d20"),k=o.n(b),$={data(){return{monExt:"",textSize:"2rem",dias:[{value:1,text:"01"},{value:2,text:"02"},{value:3,text:"03"},{value:4,text:"04"},{value:5,text:"05"},{value:6,text:"06"},{value:7,text:"07"},{value:8,text:"08"},{value:9,text:"09"},{value:10,text:"10"},{value:11,text:"11"},{value:12,text:"12"},{value:13,text:"13"},{value:14,text:"14"},{value:15,text:"15"},{value:16,text:"16"},{value:17,text:"17"},{value:18,text:"18"},{value:19,text:"19"},{value:20,text:"20"},{value:21,text:"21"},{value:22,text:"22"},{value:23,text:"23"},{value:24,text:"24"},{value:25,text:"25"},{value:26,text:"26"},{value:27,text:"27"},{value:28,text:"28"}],headers:[{text:"Tipo de Gasto",value:"gasto",width:"10%"},{text:"Tipo de Subgasto",value:"subgasto",width:"10%"},{text:"Proveedor",value:"proveedor",width:"10%"},{text:"Descripción",value:"descripcion",width:"10%"},{text:"Día Vencimiento",value:"diavencimiento",width:"10%"},{text:"Moneda",value:"moneda",width:"10%"},{text:"Monto Moneda Original",value:"montomonoriginal",width:"10%"},{text:"Monto Final en USD",value:"montofinaldolar",width:"10%"},{text:"Acciones",value:"action",width:"10%"}],items:[],mes:[],anio:[],moneda:[],id_month:"",id_year:"",id_coin:"",tipocambio:"",totalmonlocal:0,montoconversiondolar:0,totaldolar:0,totalfinal:0,aprobado:!1,dialogn:!1,id_monthn:"",id_yearn:"",loading:!1}},methods:{...Object(y["b"])(["_getCoinsList","_getProveedor","getCargarTipoGastos","getCargarTipoSubGastos","_getChargeMonth","_getChargeYear","verProyeccion","updateProyeccion","validateProyeccionAprobacion","aprobarProyeccion","copiarProyeccion","cargarProveedores"]),agregarFila(t){let e={id_gasto:"",id_tiposubgasto:"",id_entitie:"",id_coin:"",description:"",monto_monlocal:0,monto_monext:0,estado:!0};this.items.push(e),this.calcularMontoFinal(t),this.calcularTotales(t)},agregarFilaNueva(t){let e={id_gasto:"",id_tiposubgasto:"",id_entitie:"",id_coin:"",description:"",monto_monlocal:0,monto_monext:0,estado:!0};this.items.unshift(e),this.calcularMontoFinal(t),this.calcularTotales(t)},calcularMontoFinal(t){let e=this.$store.state.itemsCoinsList.filter(e=>e.id==t.id_coin)[0].symbol;t.monto_monext="USD"!=e?parseFloat(t.monto_monlocal/this.tipocambio).toFixed(2):parseFloat(t.monto_monlocal).toFixed(2),this.calcularTotales()},calcularTotales(){let t=0,e=0,o=0,a=0,i=this.$store.state.itemsCoinsList.filter(t=>"USD"==t.symbol)[0].id;this.items.filter(t=>t.id_coin==i&&!!t.estado).forEach(e=>{t+=parseFloat(e.monto_monext)}),this.items.filter(t=>t.id_coin!=i&&!!t.estado).forEach(t=>{e+=parseFloat(t.monto_monext),o+=parseFloat(t.monto_monlocal)}),this.items.filter(t=>!!t.estado).forEach(t=>{a+=parseFloat(t.monto_monext)}),this.totaldolar=parseFloat(t).toFixed(2),this.montoconversiondolar=parseFloat(e).toFixed(2),this.totalmonlocal=parseFloat(o).toFixed(2),this.totalfinal=parseFloat(a).toFixed(2)},calcularTotalTipoCambio(){let t="";this.items.filter(t=>!!t.estado).forEach(e=>{e.id_coin&&(t=this.$store.state.itemsCoinsList.filter(t=>t.id==e.id_coin)[0].symbol,e.monto_monext="USD"!=t?parseFloat(e.monto_monlocal/this.tipocambio).toFixed(2):parseFloat(e.monto_monlocal).toFixed(2))}),this.calcularTotales()},eliminarfila(t){t.estado=!1,this.calcularTotales()},volver(){this.$router.go(-1)},setData(){this.id_month=this.$store.state.proyecciones.proyeccion.id_month,this.id_year=this.$store.state.proyecciones.proyeccion.id_year,this.tipocambio=this.$store.state.proyecciones.proyeccion.tipocambio,this.items=this.$store.state.proyecciones.proyeccion.details,this.aprobado=this.$store.state.proyecciones.proyeccion.aprobadoflag,this.calcularTotalTipoCambio()},seleccionEditar(){k.a.fire({icon:"question",text:"¿Desea actualizar los datos de la proyección para el mes y año actuales o crear una nueva proyección con un mes y/o año distintos?",showConfirmButton:!0,confirmButtonColor:"#1B5E20",confirmButtonText:"Actualizar proyección actual.",showDenyButton:!0,denyButtonText:"Crear una nueva proyección.",denyButtonColor:"#E65100"}).then(t=>{t.isConfirmed&&this.editar(),t.isDenied&&(this.dialogn=!0)})},async editar(){let t=!0;if(this.$refs.frmProyeccion.validate()&&this.items.filter(t=>1==t.estado).forEach(e=>{e.id_gasto?e.errgasto="":(e.errgasto=["Dato Requerido"],t=!1),e.id_tiposubgasto?e.errsubgasto="":(e.errsubgasto=["Dato Requerido"],t=!1),e.id_entitie?e.errproveedor="":(e.errproveedor=["Dato Requerido"],t=!1),e.id_coin?e.errmoneda="":(e.errmoneda=["Dato Requerido"],t=!1),e.monto_monlocal?e.errmontomonoriginal="":(e.errmontomonoriginal=["Dato Requerido"],t=!1),e.nrodias?e.errrnodias="":(e.errrnodias=["Dato Requerido"],t=!1)}),this.$forceUpdate(),t){let t=this,e={id_branch:JSON.parse(sessionStorage.getItem("dataUser"))[0].id_branch,id_month:t.id_month,id_year:t.id_year,id:t.$route.params.id,id_user:JSON.parse(sessionStorage.getItem("dataUser"))[0].id_user,tipocambio:t.tipocambio,total_monlocal:t.totalmonlocal,total_conversionext:t.montoconversiondolar,total_monext:t.totaldolar,total_proyectado_ext:t.totalfinal,details:t.items};await t.updateProyeccion(e)}},async validateAprobacion(){this.$store.state.spiner=!0;let t={id_month:this.id_month,id_year:this.id_year},e=await this.validateProyeccionAprobacion(t);this.$store.state.spiner=!1,e.estado?k.a.fire({icon:"question",text:e.mensaje,confirmButtonText:"Si",denyButtonText:"No",showDenyButton:!0,showCancelButton:!0}).then(t=>{t.isConfirmed&&this.apProyeccion(),t.isDenied&&(this.dialog=!1)}):this.apProyeccion()},async apProyeccion(){this.$store.state.spiner=!0;let t={id:this.$route.params.id};await this.aprobarProyeccion(t),await this.verProyeccion(this.$route.params.id),this.setData(),this.$store.state.spiner=!1},async copyProyeccion(){this.loading=!0;let t={id:this.$route.params.id,id_month:this.id_monthn,id_year:this.id_yearn,id_branch:JSON.parse(sessionStorage.getItem("dataUser"))[0].id_branch,id_user:JSON.parse(sessionStorage.getItem("dataUser"))[0].id_user};await this.copiarProyeccion(t),this.$router.go(-1)}},async mounted(){this.monExt=this.moneda=JSON.parse(sessionStorage.getItem("dataBranch"))[0].moneda[0].symbol,this.$store.state.spiner=!0,await this.getCargarTipoGastos(),await this.getCargarTipoSubGastos(),await this._getCoinsList(),await this.cargarProveedores(),await this._getChargeYear(),await this._getChargeMonth(),await this.verProyeccion(this.$route.params.id),setTimeout(()=>{this.setData(),this.$store.state.spiner=!1,this.$store.state.drawer=!1},2e3)}},C=$,w=(o("6681"),o("2877")),D=Object(w["a"])(C,x,g,!1,null,"bf599842",null);e["default"]=D.exports}}]);