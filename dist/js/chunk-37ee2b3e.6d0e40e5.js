(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-37ee2b3e"],{"0e8f":function(e,t,a){"use strict";a("20f6");var o=a("e8f2");t["a"]=Object(o["a"])("flex")},b187:function(e,t,a){"use strict";a.r(t);var o=a("c6a6"),s=a("8336"),i=a("b0af"),r=a("99d9"),n=a("62ad"),l=a("8fea"),c=a("23a7"),d=a("0e8f"),u=a("4bd4"),m=a("0fd9"),p=a("2fa4"),h=a("71a3"),g=a("c671"),_=a("fe57"),f=a("8654"),b=(a("e9f5"),a("910d"),function(){var e=this,t=e._self._c;return t(i["a"],{staticClass:"px-5"},[t(r["d"],{attrs:{"primary-title":""}},[t(m["a"],[t(o["a"],{attrs:{items:e.provedores,"item-text":"namelong","item-value":"id",label:"Proveedor","return-object":"",clearable:"",readonly:"ver"==e.tipo},on:{change:function(t){return e.obtenerListado()}},model:{value:e.id_proveedor,callback:function(t){e.id_proveedor=t},expression:"id_proveedor"}}),t(p["a"])],1)],1),t(r["c"],[t(m["a"],[t(n["a"],{attrs:{cols:"3"}},[t(f["a"],{staticStyle:{"font-size":"20pt"},attrs:{label:"Monto en que va a salir del banco",readonly:"",prefix:e.symbol},model:{value:e.montoMonExt,callback:function(t){e.montoMonExt=t},expression:"montoMonExt"}})],1)],1),t(_["a"],{attrs:{color:"#A43542","slider-color":"primary","fixed-tabs":""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[t(h["a"],{attrs:{href:"#ref1"}},[e._v("STEP 1")]),t(h["a"],{attrs:{href:"#ref2",disabled:e.step2}},[e._v("STEP 2")]),t(g["a"],{attrs:{value:"ref1"}},[t(m["a"],{staticClass:"mt-5"},[t(n["a"],{attrs:{cols:"3"}},[t(f["a"],{attrs:{label:"Buscar..."},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),t(n["a"],{attrs:{cols:"3"}},[e.selected.length>0?t(s["a"],{attrs:{color:"green darken-4",dark:""},on:{click:function(t){return e.continuar()}}},[e._v("Continuar")]):e._e()],1),t(n["a"],{attrs:{md:"12",cols:"12"}},[t(l["a"],{attrs:{headers:e.headers,items:e.listPagosXProveedorCxP,"show-select":""},scopedSlots:e._u([{key:"item.item_moneda",fn:function({item:a}){return[t(o["a"],{attrs:{items:e.$store.state.itemsCoinsList,"item-text":"acronym","item-value":"id",label:"Moneda",disabled:0==e.selected.filter(e=>e.id==a.id).length},on:{change:e.calcularTotales},model:{value:e.id_coins,callback:function(t){e.id_coins=t},expression:"id_coins"}})]}},{key:"item.tipo_cambio",fn:function({item:a}){return[t(f["a"],{attrs:{type:"number",step:"0.01",disabled:0==e.selected.filter(e=>e.id==a.id).length},on:{blur:function(t){return e.calcularTotales()}},nativeOn:{focus:function(t){return e.calcularTotales()}},model:{value:e.tipocambio,callback:function(t){e.tipocambio=t},expression:"tipocambio"}})]}},{key:"item.monto_pagar_ex",fn:function({item:a}){return[t(f["a"],{attrs:{type:"number",prefix:e.symbol,"error-messages":a.errorEx},on:{blur:function(t){return e.calcularTotalesInput()}},nativeOn:{focus:function(t){return e.calcularTotalesInput()}},model:{value:a.monto_mon_ext,callback:function(t){e.$set(a,"monto_mon_ext",t)},expression:"item.monto_mon_ext"}})]}}],null,!0),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})],1)],1)],1),t(g["a"],{attrs:{value:"ref2"}},[t(u["a"],{ref:"frmRegister"},[t(m["a"],{staticClass:"mt-5"},[t(n["a"],{attrs:{md:"3",cols:"3"}},[t(f["a"],{attrs:{label:"N° de Operación","error-messages":e.msgNroOperacion,id:"nro_operacion",rules:[e=>!!e||"Datos Requerido"],"success-messages":e.successMessages},on:{blur:function(t){return e.ValidaNroOp()}},model:{value:e.nro_operacion,callback:function(t){e.nro_operacion=t},expression:"nro_operacion"}})],1),t(n["a"],{attrs:{cols:"3",md:"3"}},[t(f["a"],{attrs:{type:"date",label:"Fecha de Pago",rules:[e=>!!e||"Datos Requerido"]},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}})],1),t(n["a"],{attrs:{md:"6",cols:"6"}},[t(c["a"],{attrs:{label:"Cargar Archivo","success-messages":e.msgfile,"error-messages":e.errfile,loading:e.loadingFile},on:{change:function(t){return e.uploadFile()}},model:{value:e.payfile,callback:function(t){e.payfile=t},expression:"payfile"}})],1),t(n["a"],{attrs:{md:"4",cols:"4"}},[t(o["a"],{attrs:{items:(e.cuentas||[]).filter(t=>t.symbol==e.symbol),"item-text":"label","item-value":"id",label:"Cuenta de Salida de Banco","return-object":"",readonly:"ver"==e.tipo,rules:[e=>!!e||"Datos Requerido"]},model:{value:e.id_cuenta,callback:function(t){e.id_cuenta=t},expression:"id_cuenta"}})],1),t(n["a"],{attrs:{md:"4",cols:"4"}},["nuevo"==e.tipo?t(f["a"],{attrs:{readonly:"",label:"Banco:"},model:{value:e.id_cuenta.banco,callback:function(t){e.$set(e.id_cuenta,"banco",t)},expression:"id_cuenta.banco"}}):e._e()],1),t(n["a"],{attrs:{md:"4",cols:"4"}},["nuevo"==e.tipo?t(f["a"],{attrs:{readonly:"",label:"Moneda:"},model:{value:e.id_cuenta.moneda,callback:function(t){e.$set(e.id_cuenta,"moneda",t)},expression:"id_cuenta.moneda"}}):e._e()],1),t(n["a"],{attrs:{md:"4",cols:"4"}},["nuevo"==e.tipo?t(f["a"],{attrs:{readonly:"",label:"N° Cuenta:"},model:{value:e.id_cuenta.cuenta,callback:function(t){e.$set(e.id_cuenta,"cuenta",t)},expression:"id_cuenta.cuenta"}}):e._e()],1),t(n["a"],{attrs:{md:"4",cols:"4"}},["nuevo"==e.tipo?t(f["a"],{attrs:{readonly:"",label:"CCI:"},model:{value:e.id_cuenta.cci,callback:function(t){e.$set(e.id_cuenta,"cci",t)},expression:"id_cuenta.cci"}}):e._e()],1),t(n["a"],{attrs:{md:"4",cols:"4"}},[t(f["a"],{attrs:{label:"Comentarios",placeholder:"Comentarios......"},model:{value:e.comentarios,callback:function(t){e.comentarios=t},expression:"comentarios"}})],1),"nuevo"==e.tipo?t(n["a"],{attrs:{md:"12",cols:"12"}},[t(d["a"],{attrs:{"text-right":""}},[t(s["a"],{attrs:{color:"success",loading:e.loading},on:{click:function(t){return e._putPayForProveedor()}}},[e._v(" PROCESAR PAGO ")])],1)],1):e._e()],1)],1)],1)],1)],1)],1)}),v=[],x=(a("13d5"),a("f665"),a("7d54"),a("ab43"),a("9485"),a("a732"),a("bc3a")),P=a.n(x),y=a("3d20"),C=a.n(y),F=a("2f62"),k={props:["tipo"],data(){return{loading:!1,successMessages:"",search:"",montoMonExt:0,selected:[],nro_operacion:"",id_coins:1,date:new Date(Date.now()-6e4*(new Date).getTimezoneOffset()).toISOString().substr(0,10),payfile:[],payPath:"",id_proveedor:"",boolFile:!1,cuentas:[],id_cuenta:"",tab:null,total:0,step2:!0,name_path:"",url_documento:"",totalPagado:0,tipocambio:1,comentarios:"",loadingFile:!1,errfile:"",msgfile:"",headers:[{text:"Factura",value:"nro_factura"},{text:"Expediente",value:"codigo_house"},{text:"Procedencia",value:"procedencia"},{text:"Monto",value:"monto_pagar"},{text:"Monto Deuda",value:"monto_deuda"},{text:"Moneda Pagar",value:"item_moneda"},{text:"Tipo de Cambio",value:"tipo_cambio"},{text:"Monto Pagar",value:"monto_pagar_ex",shortable:!1}],msgNroOperacion:""}},async mounted(){let e=this;await this.cargarProveedores(),await this.obtenerListado(),await this.getListBanksDetailsCargar(),await this.limpiarDatos(),await this._getCoinsList(),setTimeout(()=>{this.obtenerDatos()},1e3),e.$store.state.drawer=!1},methods:{...Object(F["b"])(["_getListaPagosXProveedorCxP","_uploadFile","getValidaNroOp","cargarProveedores","_getCoinsList"]),obtenerListado(){this.tab=0,this.$store.state.listPagosXProveedorCxP=[],this.id_proveedor&&this._getListaPagosXProveedorCxP(this.id_proveedor.id),this.selected=[]},calcularTotalesInput(){this.montoMonExt=this.selected.reduce((e,t)=>(console.log(t),e+parseFloat(t.monto_mon_ext)),0)},async getListBanksDetailsCargar(){let e=this;var t={method:"get",url:"https://api.agentedecargaonline.com/getListBanksDetailsCargar",params:{id_branch:JSON.parse(sessionStorage.getItem("dataUser"))[0].id_branch},headers:{"auth-token":sessionStorage.getItem("auth-token"),"Content-Type":"application/json"}};await P()(t).then((function(t){e.cuentas=t.data.data})).catch((function(e){console.log(e)}))},validarMonto(e){e.max_pagar>e.monto_deuda?document.getElementById("pago"+e.id).focus():this.calcularTotal()},calcularTotal(){let e=0;this.listPagosXProveedorCxP.map(t=>{t.pagar&&(t.cktotal?(e+=parseFloat(t.monto_deuda),t.max_pagar=t.monto_deuda):e+=parseFloat(t.max_pagar))}),this.total=parseFloat(e).toFixed(4)},calcularTotalPagado(){let e=0;this.listPagosXProveedorCxP.map(t=>{e+=parseFloat(t.monto_pagar)}),this.totalPagado=parseFloat(e).toFixed(4)},setearMonto(e){e.pagar&&(this.listPagosXProveedorCxP.filter(t=>t.id==e.id)[0].cktotal=!0)},async uploadFile(){this.msgfile="",this.errfile="",this.payfile?(this.loadingFile=!0,await this._uploadFile(this.payfile),this.loadingFile=!1,this.$store.state.files.payPath?this.msgfile="Archivo cargado":this.errfile="Comuniquese con el admistrador"):this.errfile="Dato Requerido"},validar(e=!1){let t=!0,a="";return!this.payPath&&e&&(t=!1,a+="Por favor, seleccione un documento para soporte de pago. "),!this.id_cuenta&&e&&(t=!1,a+="Por favor, seleccione una cuenta. "),!this.listPagosXProveedorCxP.filter(e=>e.pagar).length>0&&(t=!1,a+="Seleccione al menos una cuenta a pagar. "),this.listPagosXProveedorCxP.filter(e=>parseFloat(e.monto_deuda)<parseFloat(e.max_pagar)).length>0&&(t=!1,a+="No puede realizar un pago mayor a la deuda. "),t||this.$swal({icon:"error",title:"Lo sentimos",text:a}),t},async _putPayForProveedor(){if(0==this.$store.state.files.payPath||!this.$store.state.files.payPath)return C.a.fire({icon:"warning",title:"Soporte de Pago",text:"SE SUGIERE GUARDAR EL SOPORTE DE PAGO POR FAVOR ANEXARLO",confirmButtonText:"Continuar, sin soporte",cancelButtonText:"Cancelar",showDenyButton:!1,allowEnterKey:!1,allowOutsideClick:!1,allowEscapeKey:!1,showCancelButton:!0,cancelButtonColor:"#B71C1C"}).then(e=>{e.isConfirmed&&this.procesarPago()}),!1;this.procesarPago()},async procesarPago(){if(this.loading=!0,this.$refs.frmRegister.validate()&&!this.msgNroOperacion){let a=this;var e={id_coins:a.id_coins,tipocambio:1==a.id_coins?1:a.tipocambio,details:a.selected,fecha_pago:a.date,nro_operacion:a.nro_operacion,comentarios:a.comentarios,id_proveedor:a.id_proveedor.id,id_path:a.$store.state.files.payPath,id_proveedor:a.id_proveedor.id,id_cuenta:a.id_cuenta.id},t={method:"post",url:"https://api.agentedecargaonline.com/setPayForProveedor",headers:{"auth-token":sessionStorage.getItem("auth-token"),"Content-Type":"application/json"},data:e};await P()(t).then((function(e){1==e.data.statusBol&&(console.log(e.data),a.$swal({icon:"success",title:"Aviso",text:e.data.data[0].mensaje}).then(e=>{e.isConfirmed&&a.$router.go(-1)}))})).catch((function(e){console.log(e)})),this.loading=!1}},continuar(){if(this.selected.some(e=>{const t=parseFloat(e.monto_deuda)<parseFloat(parseFloat(e.monto_mon_ext)/parseFloat(this.tipocambio)).toFixed(2);return t}))return C.a.fire({icon:"warning",title:"Advertencia",text:"No puede pagar más de la deuda. Verifique"}),!1;this.step2=!1,this.tab="ref2"},calcularTotales(){let e=0,t=[...this.$store.state.itemsCoinsList],a=t.filter(e=>e.id==this.id_coins)[0];this.selected.length>0&&("USD"!=a.acronym&&this.selected.forEach(t=>{t.monto_mon_ext=parseFloat(this.tipocambio*t.monto_deuda).toFixed(4),e+=parseFloat(t.monto_mon_ext)}),"USD"==a.acronym&&(this.tipocambio=1,this.selected.forEach(t=>{console.log(t),t.monto_mon_ext=parseFloat(t.monto_deuda/this.tipocambio).toFixed(4),e+=parseFloat(t.monto_mon_ext).toFixed(2)}))),this.montoMonExt=parseFloat(e).toFixed(2)},calculamonto_pagar_exrTotalesInput(){let e=0;this.selected.length>0&&this.selected.forEach(t=>{e+=parseFloat(t.monto_mon_ext)}),this.montoMonExt=parseFloat(e).toFixed(2)},limpiarDatos(){this.payfile=[],this.payPath="",this.id_proveedor="",this.boolFile=!1,this.tab="ref1",this.step2=!0,this.total=0,this.$store.state.listPagosXProveedorCxP=[]},async obtenerDatos(){if("ver"==this.tipo){let t=this,a=t.$route.params.id;var e={method:"get",url:"https://api.agentedecargaonline.com/getVerPagosPorProveedor?id="+a,headers:{"auth-token":sessionStorage.getItem("auth-token"),"Content-Type":"application/json"}};await P()(e).then((function(e){let a=e.data.data[0];t.step2=!1,t.id_proveedor=a.id_proveedor,t.$store.state.listPagosXProveedorCxP=a.details,t.id_cuenta=a.id_bank,t.name_path=a.documento,t.url_documento=a.link_documento,setTimeout(()=>{t.calcularTotalPagado()},200)})).catch((function(e){console.log(e)}))}},async ValidaNroOp(){this.msgNroOperacion="",this.successMessages="",this.$store.state.spiner=!0;let e=await this.getValidaNroOp(this.nro_operacion);this.$store.state.bancos.validacionBanco.estadoflag&&(this.msgNroOperacion=this.$store.state.bancos.validacionBanco.mensaje,document.getElementById("nro_operacion").focus()),e.mensaje&&(this.successMessages="Existen Operaciones con Nro(s) Similiares: "+e.mensaje),this.$store.state.spiner=!1}},computed:{...Object(F["c"])(["itemsProveedorList","listPagosXProveedorCxP","provedores"]),symbol(){let e="";const t=this.$store.state.itemsCoinsList.find(e=>e.id==this.id_coins);return t&&(e=t.symbol),e}},watch:{selected(){this.calcularTotales()}}},w=k,O=a("2877"),E=Object(O["a"])(w,b,v,!1,null,null,null);t["default"]=E.exports}}]);