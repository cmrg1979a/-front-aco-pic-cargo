(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3fa7a68d","chunk-2d0d5b95"],{"0e8f":function(a,t,e){"use strict";e("20f6");var o=e("e8f2");t["a"]=Object(o["a"])("flex")},7006:function(a,t,e){"use strict";e.r(t);var o=e("c6a6"),i=e("8336"),s=e("b0af"),n=e("99d9"),l=e("62ad"),r=e("8fea"),c=e("169a"),d=e("23a7"),u=e("0e8f"),p=e("132d"),m=e("0fd9"),h=e("2fa4"),g=e("71a3"),f=e("c671"),b=e("fe57"),_=e("8654"),v=(e("e9f5"),e("910d"),function(){var a=this,t=a._self._c;return t(s["a"],[t(n["d"],{attrs:{"primary-title":""}},[t(m["a"],[t(o["a"],{staticStyle:{"font-size":"20pt"},attrs:{items:a.provedores,label:"Proveedores","item-value":"id","item-text":"namelong",clearable:""},on:{change:function(t){return a.listarPagosXControlGasto()}},model:{value:a.proveedor,callback:function(t){a.proveedor=t},expression:"proveedor"}}),t(h["a"])],1)],1),t(n["c"],[t(m["a"],[t(l["a"],{attrs:{cols:"3"}},[t(_["a"],{staticStyle:{"font-size":"20pt"},attrs:{label:"Monto en que va a salir del banco",readonly:"",prefix:a.acronym},model:{value:a.montoMonExt,callback:function(t){a.montoMonExt=t},expression:"montoMonExt"}})],1)],1),t(b["a"],{attrs:{color:"#A43542","slider-color":"primary","fixed-tabs":""},model:{value:a.tab,callback:function(t){a.tab=t},expression:"tab"}},[t(g["a"],{attrs:{href:"#ref1"}},[a._v("STEP 1")]),a.selected.length>0?t(g["a"],{attrs:{href:"#ref2"}},[a._v("STEP 2")]):a._e(),t(f["a"],{staticClass:"mt-5",attrs:{value:"ref1"}},[t(n["c"],[t(m["a"],[t(l["a"],{attrs:{cols:"3"}},[t(_["a"],{attrs:{label:"Buscar..."},model:{value:a.search,callback:function(t){a.search=t},expression:"search"}})],1),t(l["a"],{attrs:{cols:"3"}},[a.selected.length>0?t(i["a"],{attrs:{color:"green darken-4",dark:""},on:{click:function(t){return a.continuar()}}},[a._v("Continuar")]):a._e()],1)],1),t(r["a"],{attrs:{headers:a.cabPagos,items:a.lstPagos,"item-key":"index",search:a.search,loading:a.loadingTable,"show-select":""},scopedSlots:a._u([{key:"item.item_moneda",fn:function({item:e}){return["A"==e.tipo?t(o["a"],{attrs:{items:a.$store.state.itemsCoinsList,"item-text":"acronym","item-value":"id",label:"Moneda",disabled:0==a.selected.filter(a=>a.id==e.id).length},on:{blur:function(t){return a.calcularTotales()}},model:{value:a.id_coins,callback:function(t){a.id_coins=t},expression:"id_coins"}}):t("p",[a._v(" "+a._s(a.acronym)+" ")])]}},{key:"item.tipo_cambio",fn:function({item:e}){return[t(_["a"],{attrs:{type:"number",step:"0.01",disabled:0==a.selected.filter(a=>a.id==e.id).length},on:{blur:function(t){return a.calcularTotales()}},nativeOn:{focus:function(t){return a.calcularTotales()}},model:{value:e.tipocambio,callback:function(t){a.$set(e,"tipocambio",t)},expression:"item.tipocambio"}})]}},{key:"item.parcial",fn:function({item:e}){return["CG"==e.tipo?t(i["a"],{attrs:{small:"",icon:"",color:"primary",disabled:0==a.selected.filter(a=>a.id==e.id).length},on:{click:function(t){return a.generarPagoParcial(e)}}},[1==e.iscontrolgasto?t(p["a"],[a._v(" mdi-credit-card-off-outline ")]):a._e()],1):t(_["a"],{attrs:{disabled:0==a.selected.filter(a=>a.id==e.id).length,prefix:a.acronym,type:"number","error-messages":e.errorEx},on:{input:function(t){return a.calcularTotales()},blur:function(t){return a.calcularTotales()}},nativeOn:{focus:function(t){return a.calcularTotales()}},model:{value:e.monto_mon_ex,callback:function(t){a.$set(e,"monto_mon_ex",t)},expression:"item.monto_mon_ex"}})]}}],null,!0),model:{value:a.selected,callback:function(t){a.selected=t},expression:"selected"}})],1)],1),t(f["a"],{attrs:{value:"ref2"}},[t(n["c"],[t(m["a"],{staticClass:"mt-5"},[t(l["a"],{attrs:{cols:"3"}},[t(_["a"],{attrs:{label:"N° de Operación","error-messages":a.msgNroOperacion,id:"nro_operacion"},on:{blur:function(t){return a.ValidaNroOp()}},model:{value:a.nro_operacion,callback:function(t){a.nro_operacion=t},expression:"nro_operacion"}})],1),t(l["a"],{attrs:{cols:"3",md:"3"}},[t(_["a"],{attrs:{type:"date",label:"Fecha "},model:{value:a.date,callback:function(t){a.date=t},expression:"date"}})],1),t(l["a"],{attrs:{md:"6",cols:"6"}},[t(u["a"],[t(d["a"],{attrs:{label:"Soporte de Pago","show-size":"","truncate-length":"50",clearable:"","success-messages":a.msgfile,"error-messages":a.errfile},on:{change:function(t){return a._uploadFile()}},model:{value:a.payfile,callback:function(t){a.payfile=t},expression:"payfile"}})],1)],1),t(l["a"],{attrs:{md:"4",cols:"4"}},[t(o["a"],{attrs:{items:a.cuentas,"item-text":"label","item-value":"id",label:"CUENTA BANCARIA","return-object":""},model:{value:a.id_cuenta,callback:function(t){a.id_cuenta=t},expression:"id_cuenta"}})],1),t(l["a"],{attrs:{md:"4",cols:"4"}},[t(_["a"],{attrs:{readonly:"",label:"Banco:"},model:{value:a.id_cuenta.banco,callback:function(t){a.$set(a.id_cuenta,"banco",t)},expression:"id_cuenta.banco"}})],1),t(l["a"],{attrs:{md:"4",cols:"4"}},[t(_["a"],{attrs:{readonly:"",label:"Moneda:"},model:{value:a.id_cuenta.moneda,callback:function(t){a.$set(a.id_cuenta,"moneda",t)},expression:"id_cuenta.moneda"}})],1),t(l["a"],{attrs:{md:"4",cols:"4"}},[t(_["a"],{attrs:{readonly:"",label:"N° Cuenta:"},model:{value:a.id_cuenta.cuenta,callback:function(t){a.$set(a.id_cuenta,"cuenta",t)},expression:"id_cuenta.cuenta"}})],1),t(l["a"],{attrs:{md:"4",cols:"4"}},[t(_["a"],{attrs:{readonly:"",label:"CCI:"},model:{value:a.id_cuenta.cci,callback:function(t){a.$set(a.id_cuenta,"cci",t)},expression:"id_cuenta.cci"}})],1),t(l["a"],{attrs:{md:"4",cols:"4"}},[t(_["a"],{attrs:{label:"Comentarios",placeholder:"Comentarios......"},model:{value:a.comentarios,callback:function(t){a.comentarios=t},expression:"comentarios"}})],1),t(l["a"],{attrs:{md:"12",cols:"12"}},[t(u["a"],{attrs:{"text-right":""}},[t(i["a"],{attrs:{color:"success",text:"",disabled:!a.id_cuenta,loading:a.loadingPago},on:{click:function(t){return a.registrarPago()}}},[a._v(" PROCESAR PAGO ")])],1)],1)],1)],1)],1)],1)],1),t(c["a"],{attrs:{overlay:!1,"max-width":"70%",transition:"dialog-transition"},model:{value:a.dialog,callback:function(t){a.dialog=t},expression:"dialog"}},[t(s["a"],[t(n["d"],{attrs:{"primary-title":""}},[a._v(" Realizar Pago Parcial ")]),t(n["c"],[t(r["a"],{staticClass:"elevation-1",attrs:{"show-select":"",headers:a.headersParcial,items:a.detalles,"item-key":"id"},model:{value:a.selectedParcial,callback:function(t){a.selectedParcial=t},expression:"selectedParcial"}})],1),t(n["a"],[t(h["a"]),t(i["a"],{attrs:{text:"",color:"green"},on:{click:function(t){return a.guardarMontoParciales()}}},[a._v("Aceptar")]),t(i["a"],{attrs:{text:"",color:"red"},on:{click:function(t){a.dialog=!a.dialog}}},[a._v("Cancelar")])],1)],1)],1)],1)}),x=[],y=(e("14d9"),e("13d5"),e("7d54"),e("ab43"),e("9485"),e("bc3a")),P=e.n(y),k=e("c1df"),C=e.n(k),F=e("2f62"),E=e("3d20"),O=e.n(E),T={props:{limpar:Boolean},async mounted(){await this.cargarProveedores(),await this.getListBanksDetailsCargar()},data(){return{msgNroOperacion:"",comentarios:"",montoDolar:0,id_coins:1,montoMonExt:0,acronym:"USD",dialog:!1,loadingPago:!1,headersParcial:[{text:"Concepto",value:"concepto"},{text:"Total Operaciones (USD)",value:"total_op"},{text:"Moneda Cuenta Banco",value:"acronym"},{text:"Total Cuenta Banco",value:"totalopcuentabanco"}],detalles:[],lstPagos:[],payfile:[],cuentas:[],selected:[],selectedParcial:[],totalDeuda:0,totalMonto:0,tab:null,step2:!0,boolFile:!1,id_cuenta:"",nro_operacion:"",search:"",tipocambio:1,payPath:0,date:"",dataList:!1,cabPagos:[{text:"Expediente",value:"nro_master",shortable:!1},{text:"Factura/ Proforma",value:"expedientes"},{text:"Procedencia",value:"procedencia",shortable:!1},{text:"Monto (USD)",value:"monto_dolar"},{text:"Monto Factura",value:"monto_banco",shortable:!1},{text:"Tipo Cambio",value:"tipo_cambio"},{text:"Moneda Pagar",value:"item_moneda"},{text:"Monto Pagar",value:"parcial",shortable:!1}],msgfile:"",errfile:"",proveedor:"",loadingTable:!1}},methods:{...Object(F["b"])(["cargarProveedores","_getCoinsList","_uploadFile","getValidaNroOp"]),calcularTotales(){let a=0,t=0,e=0;this.selected.forEach(async o=>{"CG"==o.tipo?(e=0,await o.details.forEach(i=>{i.pagar&&(o.tipocambio=parseFloat(i.tipocambio).toFixed(2),e=parseFloat(e)+parseFloat(i.totalopcuentabanco),a=parseFloat(a)+parseFloat(i.total_op),t=parseFloat(t)+parseFloat(i.totalopcuentabanco)),this.id_coins=i?this.$store.state.itemsCoinsList.filter(a=>a.acronym==i.acronym)[0].id:1}),o.monto_mon_ex=e):(o.monto_mon_ex=o.monto_mon_ex?o.monto_mon_ex:o.monto_banco,t+=parseFloat(o.monto_mon_ex)),this.acronym=this.$store.state.itemsCoinsList.filter(a=>a.id==this.id_coins)[0].acronym}),this.montoMonExt=parseFloat(t).toFixed(2),this.calcularTotalesInput(),this.acronym=this.$store.state.itemsCoinsList.filter(a=>a.id==this.id_coins)[0].acronym},async calcularTotalesInput(){let a=0;await this.selected.forEach(t=>{t.errorEx="",parseFloat(t.monto_mon_ex)>parseFloat(parseFloat(t.monto_banco)*parseFloat(t.tipocambio))?t.errorEx="El monto no puede ser mayor que el monto como deuda":a=parseFloat(a)+parseFloat(t.monto_mon_ex)})},async listarPagosXControlGasto(){var a=this;if(a.loadingTable=!0,a.lstPagos=[],a.nro_operacion=null,a.payfile=null,a.msgfile=null,a.errfile=null,a.id_cuenta="",a.comentarios=null,a.proveedor){var t={method:"get",url:"https://api.agentedecargaonline.com/listPagoControlGastoXProveedor/"+a.proveedor,headers:{"auth-token":sessionStorage.getItem("auth-token"),"Content-Type":"application/json"}};await P()(t).then((function(t){let e=t.data;if("undefined"!=typeof e.data){let e=t.data.data;e.forEach(a=>{a.tipocambio=a.tipocambio?a.tipocambio:1});let o=0;e.forEach(a=>{a.index=o,o++}),a.lstPagos=e,a.loadingTable=!1}else a.lstPagos=[],a.loadingTable=!1,O.a.fire({icon:"info",title:"AVISO IMPORTANTE",text:t.data.mensaje})})).catch((function(a){console.log(a)})),a.dataList=!0}else a.lstPagos=[],a.loadingTable=!1,a.tab=1,a.payfile=[]},calcularMontoPagar(){if(this.lstPagos.length>0){let a=this.lstPagos.filter(a=>1==a.pagar).map(a=>a.monto).reduce((a,t)=>parseFloat(a)+parseFloat(t),parseFloat(0));this.totalMonto=parseFloat(a).toFixed(2)}else this.totalMonto=0},guardarMontoParciales(){let a=null;this.item.details.forEach(t=>{a=this.selectedParcial.filter(a=>a.id==t.id).length,t.pagar=1==a}),this.calcularTotales(),this.dialog=!1},async getListBanksDetailsCargar(){let a=this;var t={method:"get",url:"https://api.agentedecargaonline.com/getListBanksDetailsCargar",params:{id_branch:JSON.parse(sessionStorage.getItem("dataUser"))[0].id_branch},headers:{"auth-token":sessionStorage.getItem("auth-token"),"Content-Type":"application/json"}};await P()(t).then((function(t){let e=t.data.data;a.cuentas=e})).catch((function(a){console.log(a)}))},continuar(){this.step2=!1,this.tab="ref2"},_uploadFile(){var a=this;if(a.msgfile="",a.errfile="",a.payfile){var t=e("5a30"),o=(e("3e8f"),new t);a=this;o.append("name","Prueba"),o.append("file",a.payfile);var i={method:"post",url:"https://api.agentedecargaonline.com/uploadAllPath",headers:{"auth-token":sessionStorage.getItem("auth-token"),"Content-Type":"application/json"},data:o};P()(i).then((function(t){a.boolFile=!0,a.payPath=JSON.stringify(t.data.data[0].insertid),a.msgfile="Archivo Cargado correctamente."})).catch((function(t){a.errfile="Ocurrió un problmea conuníquese con el administrador del sistema",console.log(t)}))}},async registrarPago(){if(0==this.payPath||!this.payPath)return O.a.fire({icon:"warning",title:"Soporte de Pago",text:"SE SUGIERE GUARDAR EL SOPORTE DE PAGO POR FAVOR ANEXARLO",confirmButtonText:"Continuar, sin soporte",cancelButtonText:"Cancelar",showDenyButton:!1,allowEnterKey:!1,allowOutsideClick:!1,allowEscapeKey:!1,showCancelButton:!0,cancelButtonColor:"#B71C1C"}).then(a=>{a.isConfirmed&&this.pagar()}),!1;this.pagar()},async pagar(){let a=this;a.loadingPago=!0;let t=a.selected.map(a=>a.isaprobacion),e=a.selected.map(a=>a.iscontrolgasto),o=a.selected.map(a=>a.isprogramado),i=a.selected.map(a=>a.id),s=a.selected.map(a=>a.monto_mon_ex),n=a.selected.map(a=>a.tipo),l=[];a.selected.filter(a=>1==a.iscontrolgasto).forEach(a=>{a.details.forEach(a=>{1==a.pagar&&l.push(a.id)})});let r={isaprobacion:t,iscontrolgasto:e,isprogramado:o,id:i,monto:s,id_concepto:l,id_path:a.payPath,id_cuenta:a.id_cuenta.id,fecha:a.date,nro_operacion:a.nro_operacion,id_proveedor:a.proveedor,id_user:JSON.parse(sessionStorage.getItem("dataUser"))[0].id_user,tipocambio:a.selected.map(a=>a.tipocambio),id_coins:a.id_coins,comentarios:a.comentarios,tipo:n,id_correlativo:a.selected.map(a=>a.id_correlativo?a.id_correlativo:null)};var c={method:"post",url:"https://api.agentedecargaonline.com/registro_pago_detalles",headers:{"auth-token":sessionStorage.getItem("auth-token"),"Content-Type":"application/json"},data:r};await P()(c).then((function(t){t.data.statusBol&&(a.$swal({icon:"success",title:"AVISO",text:t.data.data.msg}),a.$store.state.actualizar=!a.$store.state.actualizar)})).catch((function(a){console.log(a)})),this.loadingPago=!1,this.$emit("cerrarModal",!0)},async limpiarFormulario(){this.proveedor=null,this.lstPagos=[],this.payfile=[],this.cuentas=[],this.selected=[],this.totalDeuda=0,this.totalMonto=0,this.tab=null,this.step2=!0,this.boolFile=!1,this.id_cuenta="",this.nro_operacion="",this.search="",this.payPath=0,this.date=C()(new Date).format("YYYY-MM-DD"),await this.cargarProveedores(),await this.getListBanksDetailsCargar()},generarPagoParcial(a){this.item=a,this.selectedParcial=a.details.filter(a=>1==a.pagar),this.detalles=a.details,this.dialog=!0},obtenerMontoPagar(){this.totalMonto=0;let a=0;this.selected.forEach(t=>{1==t.iscontrolgasto?t.details.forEach(t=>{t.pagar&&(a+=parseFloat(t.total_op))}):a+=parseFloat(t.monto_actual)}),this.totalMonto=parseFloat(a).toFixed(2)},async ValidaNroOp(){this.msgNroOperacion="",this.$store.state.spiner=!0,await this.getValidaNroOp(this.nro_operacion),this.$store.state.bancos.validacionBanco.estadoflag?(this.msgNroOperacion=this.$store.state.bancos.validacionBanco.mensaje,document.getElementById("nro_operacion").focus()):this.msgNroOperacion="",this.$store.state.spiner=!1}},computed:{...Object(F["c"])(["provedores","limpiar"])},watch:{limpiar(){this.dataList=!1,this.limpiarFormulario()},selected(){this.calcularTotales()}}},w=T,M=e("2877"),S=Object(M["a"])(w,v,x,!1,null,null,null);t["default"]=S.exports}}]);