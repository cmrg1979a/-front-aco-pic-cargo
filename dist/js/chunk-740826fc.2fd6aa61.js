(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-740826fc"],{"0e8f":function(e,t,a){"use strict";a("20f6");var o=a("e8f2");t["a"]=Object(o["a"])("flex")},"453b":function(e,t,a){"use strict";a.r(t);var o=a("c6a6"),i=a("8336"),s=a("b0af"),n=a("99d9"),r=a("cc20"),l=a("62ad"),c=a("8fea"),d=a("169a"),m=a("23a7"),u=a("0e8f"),p=a("4bd4"),h=a("132d"),g=a("0fd9"),_=a("1f4f"),f=a("2fa4"),v=a("71a3"),P=a("c671"),y=a("fe57"),x=a("8654"),b=(a("e9f5"),a("910d"),function(){var e=this,t=e._self._c;return t("div",{},[t(c["a"],{staticClass:"mx-4 ext-uppercase",attrs:{headers:e.headers,items:e.$store.state.programaciones.listado,expanded:e.expanded,"single-expand":e.singleExpand,"item-key":"id","show-expand":"","custom-filter":e.filterOnlyCapsText,"fixed-header":""},on:{"update:expanded":function(t){e.expanded=t},"click:row":e.clickRow},scopedSlots:e._u([{key:"item.total_dolar_total",fn:function({item:t}){return[e._v(" $ "+e._s(t.total_dolar)+" ")]}},{key:"item.total_soles_total",fn:function({item:t}){return[e._v(" "+e._s(e.monExt)+" "+e._s(t.total_soles)+" ")]}},{key:"expanded-item",fn:function({item:a}){return[t("td",{attrs:{colspan:"11"}},[t(_["a"],{staticStyle:{width:"100%"}},[t("thead",[t("tr",{staticStyle:{background:"#fff1cf"}},[t("th",[e._v("Accion")]),t("th",[e._v("Proveedor")]),t("th",[e._v("Monto")]),t("th",[e._v("Deuda Actual")]),t("th",[e._v("Estado")])])]),t("tbody",e._l(a.details,(function(o){return t("tr",{key:o.id},[t("td",[0==o.status?t(i["a"],{attrs:{icon:"",color:"primary"},on:{click:function(t){return e.payment(o,a.id)}}},[t(h["a"],[e._v("mdi-hand-coin")])],1):e._e(),0==o.status?t(i["a"],{attrs:{icon:"",color:"red"},on:{click:function(t){return e.eliminar(a,o.id_proveedor,o.id_details)}}},[t(h["a"],[e._v("mdi-delete")])],1):e._e()],1),t("td",[e._v(e._s(o.proveedor))]),t("td",[e._v(e._s(o.symbol)+" "+e._s(o.monto_original))]),t("td",[e._v(e._s(o.symbol)+" "+e._s(o.monto))]),t("td",[0==o.status?t(r["a"],{attrs:{color:"orange",outlined:""}},[e._v(" Por Pagar ")]):e._e(),1==o.status?t(r["a"],{attrs:{color:"green",outlined:""}},[e._v(" Pagado ")]):e._e()],1)])})),0)])],1)]}}],null,!0)}),t(d["a"],{attrs:{fullscreen:"",persistent:"",transition:"dialog-transition"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[t(s["a"],[t(n["d"],{attrs:{"primary-title":""}},[e._v(" PROVEEDOR: "+e._s(e.nameproveedor)+" "),t(f["a"]),t(i["a"],{attrs:{icon:"",color:"default"},on:{click:function(t){e.dialog=!e.dialog}}},[t(h["a"],[e._v("mdi-close")])],1)],1),t(n["c"],[t(g["a"],[t(l["a"],{attrs:{cols:"3"}},[t(x["a"],{staticStyle:{"font-size":"20pt, color:'green'"},attrs:{label:"Monto en que va a salir del banco",readonly:"",prefix:e.acronym},model:{value:e.montoMonExt,callback:function(t){e.montoMonExt=t},expression:"montoMonExt"}})],1)],1),t(y["a"],{attrs:{color:"#A43542","slider-color":"primary","fixed-tabs":""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[t(v["a"],{attrs:{href:"#ref1"}},[e._v("STEP 1")]),e.selected.length>0?t(v["a"],{attrs:{href:"#ref2"}},[e._v("STEP 2")]):e._e(),t(P["a"],{attrs:{value:"ref1"}},[t(g["a"],[t(l["a"],{attrs:{cols:"3"}},[t(x["a"],{attrs:{label:"Buscar..."},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),t(l["a"],{attrs:{cols:"3"}},[e.selected.length>0?t(i["a"],{attrs:{color:"green darken-4",dark:""},on:{click:function(t){return e.continuar()}}},[e._v("Continuar")]):e._e()],1)],1),t(c["a"],{staticClass:"elevation-1",attrs:{headers:e.headersProgXProveedor,items:e.$store.state.programaciones.listProgramacionxProveedor,"show-select":"","item-key":"id",search:e.search},scopedSlots:e._u([{key:"item.item_moneda",fn:function({item:a}){return[t(o["a"],{attrs:{items:e.$store.state.itemsCoinsList,"item-text":"acronym","item-value":"id",label:"Moneda",disabled:0==e.selected.filter(e=>e.id==a.id).length},on:{blur:function(t){return e.calcularTotales()}},model:{value:a.id_coins,callback:function(t){e.$set(a,"id_coins",t)},expression:"item.id_coins"}})]}},{key:"item.tipo_cambio",fn:function({item:a}){return[t(x["a"],{attrs:{type:"number",step:"0.01",disabled:0==e.selected.filter(e=>e.id==a.id).length},on:{blur:function(t){return e.calcularTotales()}},nativeOn:{focus:function(t){return e.calcularTotales()}},model:{value:a.tipocambio,callback:function(t){e.$set(a,"tipocambio",t)},expression:"item.tipocambio"}})]}},{key:"item.monto_mon_extranjera",fn:function({item:t}){return[e._v(" "+e._s(t.acronym)+" "+e._s(t.monto_mon_ex)+" ")]}},{key:"item.action",fn:function({item:a}){return[t(i["a"],{attrs:{icon:"",color:"red"},on:{click:function(t){return e.eliminarDetalle(a)}}},[t(h["a"],[e._v("mdi-delete")])],1)]}},{key:"item.monto_pagar",fn:function({item:a}){return[t(x["a"],{attrs:{type:"number",disabled:0==e.selected.filter(e=>e.id==a.id).length,prefix:e.acronym,"error-messages":a.errorEx},on:{blur:function(t){return e.calcularTotalesInput()}},nativeOn:{focus:function(t){return e.calcularTotalesInput()}},model:{value:a.monto_mon_ext,callback:function(t){e.$set(a,"monto_mon_ext",t)},expression:"item.monto_mon_ext"}})]}}],null,!0),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})],1),t(P["a"],{attrs:{value:"ref2"}},[t(p["a"],{ref:"frmPagoStep2"},[t(g["a"],{staticClass:"mt-5"},[t(l["a"],{attrs:{cols:"3"}},[t(x["a"],{attrs:{label:"N° de Operación",rules:[e=>!!e||"Datos Requerido"],"error-messages":e.msgNroOperacion,id:"nro_operacion"},on:{blur:function(t){return e.ValidaNroOp()}},model:{value:e.nro_operacion,callback:function(t){e.nro_operacion=t},expression:"nro_operacion"}})],1),t(l["a"],{attrs:{cols:"3",md:"3"}},[t(x["a"],{attrs:{type:"date",label:"Fecha",rules:[e=>!!e||"Datos Requerido"]},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}})],1),t(l["a"],{attrs:{md:"6",cols:"6"}},[t(m["a"],{attrs:{label:"Cargar Archivo","success-messages":e.msgfile,"error-messages":e.errfile,rules:[e=>!!e||"Datos Requerido"],loading:e.loadingFile},on:{change:function(t){return e.uploadFile()}},model:{value:e.payfile,callback:function(t){e.payfile=t},expression:"payfile"}})],1),t(l["a"],{attrs:{md:"4",cols:"4"}},[t(o["a"],{attrs:{items:e.cuentas.filter(t=>t.symbol==e.acronym),"item-text":"label","item-value":"id",label:"CUENTA BANCARIA",rules:[e=>!!e||"Datos Requerido"],"return-object":""},model:{value:e.id_cuenta,callback:function(t){e.id_cuenta=t},expression:"id_cuenta"}})],1),t(l["a"],{attrs:{md:"4",cols:"4"}},[t(x["a"],{attrs:{readonly:"",label:"Banco:"},model:{value:e.id_cuenta.banco,callback:function(t){e.$set(e.id_cuenta,"banco",t)},expression:"id_cuenta.banco"}})],1),t(l["a"],{attrs:{md:"4",cols:"4"}},[t(x["a"],{attrs:{readonly:"",label:"Moneda:"},model:{value:e.id_cuenta.moneda,callback:function(t){e.$set(e.id_cuenta,"moneda",t)},expression:"id_cuenta.moneda"}})],1),t(l["a"],{attrs:{md:"4",cols:"4"}},[t(x["a"],{attrs:{readonly:"",label:"N° Cuenta:"},model:{value:e.id_cuenta.cuenta,callback:function(t){e.$set(e.id_cuenta,"cuenta",t)},expression:"id_cuenta.cuenta"}})],1),t(l["a"],{attrs:{md:"4",cols:"4"}},[t(x["a"],{attrs:{readonly:"",label:"CCI:"},model:{value:e.id_cuenta.cci,callback:function(t){e.$set(e.id_cuenta,"cci",t)},expression:"id_cuenta.cci"}})],1),t(l["a"],{attrs:{md:"4",cols:"4"}},[t(x["a"],{attrs:{label:"Comentarios",placeholder:"Comentarios......"},model:{value:e.comentarios,callback:function(t){e.comentarios=t},expression:"comentarios"}})],1),t(l["a"],{attrs:{md:"12",cols:"12"}},[t(u["a"],{attrs:{"text-right":""}},[t(i["a"],{attrs:{color:"success",loading:e.loadingRegistro,text:""},on:{click:function(t){return e.registrarPago()}}},[e._v(" PROCESAR PAGO ")])],1)],1)],1)],1)],1)],1)],1)],1)],1)],1)}),C=[],k=(a("14d9"),a("7d54"),a("ab43"),a("bc3a")),F=a.n(k),w=a("c1df"),D=a.n(w),S=a("2f62"),T=a("3d20"),$=a.n(T),E={name:"listProgrammedPaymentComponent",components:{ModalPagoControlGastoComponent:()=>a.e("chunk-2d0d5b95").then(a.bind(null,"7006"))},data:()=>({monExt:"",msgNroOperacion:"",id:null,id_proveedor:null,comentarios:"",id_coins:1,tipocambio:1,acronym:"USD",msgfile:"",errfile:"",id:"",nro_operacion:"",search:"",headers:[{text:"Correlativo",value:"correlativo"},{text:"Fecha Programada",value:"fecha"},{text:"Total Pagar Dolares",value:"total_dolar_total"},{text:"Total Pagar Soles",value:"total_soles_total"}],listado:[],selected:[],dialogPagoControlGasto:!1,dialogProcess:!1,payfile:null,payoperacion:"",paybanco:"",paymoneda:"",paymonto:"",itemsSPaymentConceptos:[],dialogPath:!1,pathfile:"",sPaymentId:"",paymentname:"",paymentMaster:"",paymentmonto:"",payPath:"",nameproveedor:"",id_proveedor:"",id_orders:"",dialogListInvoince:!1,itemsListInvoice:[],date:D()(new Date).format("YYYY-MM-DD"),pathfileAll:"",boolFile:!1,fecha:D()(new Date).add(7,"days").format("YYYY-MM-DD"),menu:!1,cuentas:[],itemsProveedores:[],tab:null,step2:!0,total:0,id_proveedor:"",id_cuenta:"",dialgoCXP:!1,search:"",montoDolar:0,montoMonExt:0,headersCXP:[{text:"Fecha",value:"fecha"},{text:"Expediente",value:"codigo_house"},{text:"Factura",value:"nro_factura"},{text:"Cliente",value:"tradename_cliente"},{text:"Cliente Pagó",value:"statuspago"},{text:"Monto",value:"monto_pagar"},{text:"Monto Deuda",value:"monto_deuda"},{text:"Moneda Pagar",value:"item_moneda"},{text:"Tipo Cambio",value:"tipo_cambio"},{text:"Pago Total",value:"check_total"},{text:"Pago Parcial",value:"pago"},{text:"Pagar",value:"pagarflag"}],headersProgXProveedor:[{text:"Expediente",value:"nro_master"},{text:"Factura/ Proforma",value:"expedientes"},{text:"Procedencia",value:"procedencia"},{text:"Monto (USD)",value:"monto"},{text:"Monto Factura",value:"monto_mon_extranjera"},{text:"Tipo Cambio",value:"tipo_cambio"},{text:"Moneda Pagar",value:"item_moneda"},{text:"Monto Pagar",value:"monto_pagar"},{text:"Acción",value:"action"}],expanded:[],expand:[],singleExpand:!1,idDetails:"",dialog:!1,nameproveedor:"",date:"",loadingFile:!1,loadingRegistro:!1,errorTipCambio:"",symbol:"USD"}),async mounted(){this.monExt=this.moneda=JSON.parse(sessionStorage.getItem("dataBranch"))[0].moneda[0].symbol,this.$store.state.spiner=!0,await this.ListProgrammedPayment(),await this.cargarProveedores(),await this.getListBanksDetailsCargar(),await this._getCoinsList(),await this.limpiarDatos(),this.$store.state.spiner=!1},methods:{...Object(S["b"])(["_getListaPagosXProveedorCxP","getListProgramacion","_getCoinsList","_uploadFile","setPagoProgramado","ListProgrammedPayment","eliminarProgramacion","eliminarProgramacionDetalle","getValidaNroOp","cargarProveedores"]),async ValidaNroOp(){this.msgNroOperacion="",this.$store.state.spiner=!0,await this.getValidaNroOp(this.nro_operacion),this.$store.state.bancos.validacionBanco.estadoflag?(this.msgNroOperacion=this.$store.state.bancos.validacionBanco.mensaje,document.getElementById("nro_operacion").focus()):this.msgNroOperacion="",this.$store.state.spiner=!1},getAcronym(){this.acronym=this.$store.state.itemsCoinsList.filter(e=>e.id==this.id_coins)[0].symbol,"USD"!=this.acronym&&1==this.tipocambio&&(this.errorTipCambio="Seleccione un tipo de cambio")},limpiarDatos(){this.payfile=null,this.payPath="",this.id_proveedor="",this.boolFile=!1,this.tab="ref1",this.step2=!0,this.total=0,this.$store.state.listPagosXProveedorCxP=[]},clickRow(e,t){if(t.isExpanded){const t=this.expanded.findIndex(t=>t===e);this.expanded.splice(t,1)}else this.expanded.push(e)},async obtenerListado(){await this._getListaPagosXProveedorCxP(this.id_proveedor)},validarSeleccionado(){this.fecha=this.selected[0].fecha},cerrarModal(){this.$emit("cerrar",!1)},async payment(e,t){this.tab="ref1",this.payfile=[],this.comentarios=null,this.id=t,this.id_proveedor=e.id_proveedor,this.id_coins=e.id_coins,this.id_coins=1,this.selected=[],this.date=null,this.nro_operacion=null,this.id_cuenta="",this.nameproveedor=e.proveedor,this.$store.state.files.payPath="",await this.getListProgramacion({id_proveedor:e.id_proveedor,id:t,id_coins:e.id_coins}),this.dialog=!0},calcularTotales(){let e=0;this.selected.length>0&&this.selected.forEach(t=>{this.tipocambio=t.tipocambio,this.id_coins=t.id_coins,t.monto_mon_ext=parseFloat(parseFloat(t.monto)*parseFloat(t.tipocambio)).toFixed(2),e=parseFloat(e)+parseFloat(t.monto_mon_ext)}),this.acronym=this.$store.state.itemsCoinsList.filter(e=>e.id==this.id_coins)[0].symbol,this.montoMonExt=parseFloat(e).toFixed(2)},calcularTotalesInput(){let e=0;this.selected.forEach(t=>{t.errorEx="",parseFloat(t.monto_mon_ext)>parseFloat(parseFloat(t.monto)*parseFloat(t.tipocambio))?t.errorEx="El monto no puede ser mayor que el monto como deuda":e=parseFloat(e)+parseFloat(t.monto_mon_ext)}),this.montoMonExt=parseFloat(e).toFixed(2)},processPayment(e,t,a,o,i){this.sPaymentId=e,this.paymentname=t,this.paymentMaster=a,this.paymentmonto=o,this.nameproveedor=i,this.payfile="",this._getRequestPaymentConceptos(this.sPaymentId),this.dialogProcess=!0},async _getRequestPaymentConceptos(e){var t=this,a={method:"post",url:"https://api.agentedecargaonline.com/getRequestPaymentConceptos/"+e,headers:{"auth-token":sessionStorage.getItem("auth-token"),"Content-Type":"application/json"}};await F()(a).then((function(e){t.itemsSPaymentConceptos=e.data.data})).catch((function(e){console.log(e)}))},async uploadFile(){this.msgfile="",this.errfile="",this.payfile?(this.loadingFile=!0,await this._uploadFile(this.payfile),this.loadingFile=!1,this.$store.state.files.payPath?this.msgfile="Archivo cargado":this.errfile="Comuniquese con el admistrador"):this.errfile="Dato Requerido"},async registrarPago(){if(this.$refs.frmPagoStep2.validate()){this.loadingRegistro=!0;let e={id_coins:this.id_coins,tipocambio:1==this.id_coins?1:this.tipocambio,details:this.selected,fecha:this.date,nro_operacion:this.nro_operacion,id_cuentas:this.id_cuenta.id,id_path:this.$store.state.files.payPath,id_proveedor:this.id_proveedor};await this.setPagoProgramado(e),this.dialog=!1,this.loadingRegistro=!1}},async getListBanksDetailsCargar(){let e=this;var t={method:"get",url:"https://api.agentedecargaonline.com/getListBanksDetailsCargar",params:{id_branch:JSON.parse(sessionStorage.getItem("dataUser"))[0].id_branch},headers:{"auth-token":sessionStorage.getItem("auth-token"),"Content-Type":"application/json"}};await F()(t).then((function(t){e.cuentas=t.data.data})).catch((function(e){console.log(e)}))},validarMonto(e){e.max_pagar>e.monto_deuda?document.getElementById("pago"+e.id).focus():this.calcularTotal()},calcularTotal(){let e=0;this.listPagosXProveedorCxP.map(t=>{t.pagar&&(t.cktotal?(e+=parseFloat(t.monto_deuda),t.max_pagar=t.monto_deuda):e+=parseFloat(t.max_pagar))}),this.total=parseFloat(e).toFixed(4)},calcularTotalPagado(){let e=0;this.listPagosXProveedorCxP.map(t=>{e+=parseFloat(t.monto_pagar)}),this.totalPagado=parseFloat(e).toFixed(4)},setearMonto(e){e.pagar&&(this.listPagosXProveedorCxP.filter(t=>t.id==e.id)[0].cktotal=!0)},validar(e=!1){let t=!0,a="";return!this.payPath&&e&&(t=!1,a+="Por favor, seleccione un documento para soporte de pago. "),!this.id_cuenta&&e&&(t=!1,a+="Por favor, seleccione una cuenta. "),!this.listPagosXProveedorCxP.filter(e=>e.pagar).length>0&&(t=!1,a+="Seleccione al menos una cuenta a pagar. "),this.listPagosXProveedorCxP.filter(e=>e.monto_deuda<e.max_pagar).length>0&&(t=!1,a+="No puede realizar un pago mayor a la deuda. "),t||this.$swal({icon:"error",title:"Lo sentimos",text:a}),t},async _putPayForProveedor(){if(this.validar(!0)){let a=this;var e={id_proveedor:a.id_proveedor.id,id_path:a.payPath,details:a.listPagosXProveedorCxP.filter(e=>e.pagar),id_cuenta:a.id_cuenta.id},t={method:"post",url:"https://api.agentedecargaonline.com/setPayForProveedor",headers:{"auth-token":sessionStorage.getItem("auth-token"),"Content-Type":"application/json"},data:e};await F()(t).then((function(e){1==e.data.statusBol&&(a.$swal({icon:"success",title:"Aviso",text:e.data.data.msg}),a.ActualizarPagoProgramado())})).catch((function(e){console.log(e)}))}},continuar(){this.step2=!1,this.tab="ref2"},async _setSPaymentFile(){var e=this;e.$swal({icon:"info",title:"Procesando pago...",text:"Por favor espere"});var t={fecha_operacion:e.date,nro_operacion:e.payoperacion,id_banks:e.paybanco,id_coins:e.paymoneda,monto:e.paymonto,id_path:e.payPath,status:1,id_request:e.sPaymentId,itemsSPaymentConceptos:e.itemsSPaymentConceptos,id_proveedor:e.id_proveedor,id_orders:e.id_orders},a={method:"post",url:"https://api.agentedecargaonline.com/setSPaymentFile/",headers:{"auth-token":sessionStorage.getItem("auth-token"),"Content-Type":"application/json"},data:t};await F()(a).then((function(t){e.$swal({icon:"success",title:"Pago Procesado",text:"El pago ha sido procesado correctamente"}),e.ActualizarPagoProgramado(),e.cleandData(),e.dialogProcess=!1})).catch((function(e){console.log(e)}))},cleandData(){this.date="",this.payoperacion="",this.paybanco="",this.paymoneda="",this.paymonto="",this.payPath=[],this.payFile="",this.pathfile="",this.boolFile=!1,this.selected=[]},async obtenerDatos(){if("ver"==this.tipo){let t=this,a=t.$route.params.id;var e={method:"get",url:"https://api.agentedecargaonline.com/getVerPagosPorProveedor?id="+a,headers:{"auth-token":sessionStorage.getItem("auth-token"),"Content-Type":"application/json"}};await F()(e).then((function(e){let a=e.data.data[0];t.step2=!1,t.id_proveedor=a.id_proveedor,t.$store.state.listPagosXProveedorCxP=a.details,t.id_cuenta=a.id_bank,t.name_path=a.documento,t.url_documento=a.link_documento,setTimeout(()=>{t.calcularTotalPagado()},200)})).catch((function(e){console.log(e)}))}},async ActualizarPagoProgramado(){var e=this,t={method:"put",url:"https://api.agentedecargaonline.com/updateProgrammedPayment/"+e.idDetails,headers:{"auth-token":sessionStorage.getItem("auth-token"),"Content-Type":"application/json"}};await F()(t).then((function(t){e.dialgoCXP=!1,e.dialogProcess=!1,e.ListProgrammedPayment()})).catch((function(e){console.log(e)}))},async eliminar(e,t,a){$.a.fire({icon:"question",text:"¿Está seguro que de desea eliminar esta programación?",showDenyButton:"Cancelar",denyButtonText:"Cancelar",confirmButtonText:"Eliminar",confirmButtonColor:"green"}).then(o=>{o.isConfirmed&&(console.log(e),this.eliminarProgramacion({id:parseInt(e.correlativo),id_proveedor:t,id_details:a}))})},filterOnlyCapsText(e,t){let a=t?t.toLocaleUpperCase():null;return null!=e&&null!=t&&"string"===typeof e&&-1!==e.toString().toLocaleUpperCase().indexOf(a)},verDocumento(e){window.open(e,"_blank")},async eliminarDetalle(e){await $.a.fire({icon:"question",html:`Está seguro que desea eliminar de la programación el registro correspondiente al exp <b>${e.nro_master}</b>`,confirmButtonText:"Eliminar",denyButtonText:"Cancelar",showDenyButton:"Cancelar"}).then(async t=>{t.isConfirmed&&(this.$store.state.spiner=!0,await this.eliminarProgramacionDetalle({id:e.id}),this.id_coins=1,this.tipocambio=1,this.selected=[],this.date=null,this.nro_operacion=null,this.id_cuenta="",this.nameproveedor=e.proveedor,this.$store.state.files.payPath="",await this.getListProgramacion({id_proveedor:this.id_proveedor,id:this.id}),this.$store.state.spiner=!1)})}},computed:{...Object(S["c"])(["itemsProveedorList","listPagosXProveedorCxP","actualizar"])},watch:{selected(){this.calcularTotales()}}},M=E,O=a("2877"),I=Object(O["a"])(M,b,C,!1,null,null,null);t["default"]=I.exports}}]);