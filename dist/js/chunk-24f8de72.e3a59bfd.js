(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-24f8de72"],{"598e":function(e,a,t){},"6dc3":function(e,a,t){"use strict";t("598e")},d1fc:function(e,a,t){"use strict";t.r(a);var o=t("c6a6"),r=t("8336"),i=t("b0af"),s=t("99d9"),n=t("62ad"),l=t("a523"),c=t("8fea"),d=t("169a"),u=t("23a7"),h=t("4bd4"),m=t("8e36"),p=t("0fd9"),f=t("2fa4"),b=t("71a3"),v=t("c671"),g=t("fe57"),x=t("aac8"),E=t("8654"),_=function(){var e=this,a=e._self._c;return a(l["a"],[a(h["a"],[a(p["a"],[e.nuevoExpedienteFlag()?a(n["a"],{attrs:{cols:"3"}},[a(o["a"],{attrs:{items:e.$store.state.itemsMasterList,label:"Expediente","item-text":"code_master","item-value":"id"},on:{change:function(a){return e.nombreCampania()}},model:{value:e.id_exp,callback:function(a){e.id_exp=a},expression:"id_exp"}})],1):e._e(),a(n["a"],{attrs:{cols:"3"}},[a(E["a"],{attrs:{name:"name",label:"Nombre de la campaña",id:"id",readonly:e.companiaflag},model:{value:e.nombrecampania,callback:function(a){e.nombrecampania=a},expression:"nombrecampania"}})],1),a(n["a"],{attrs:{cols:"1"}},[e.nuevoExpediente?a(E["a"],{attrs:{label:"Nro Cuotas",type:"number",min:"1"},on:{change:e.addCol},model:{value:e.nro_cuotas,callback:function(a){e.nro_cuotas=a},expression:"nro_cuotas"}}):e._e()],1),a(n["a"],{attrs:{cols:"5"}},[a(r["a"],{attrs:{color:"success",disabled:e.subirarchivoflag()},on:{click:e.abrirDialog}},[e._v("Subir Archivo ")])],1)],1),a(p["a"],[a(n["a"],{attrs:{cols:"12"}},[e.nro_cuotas>0&&e.nuevoExpediente?a("center",[e._v(" PORCENTAJE Y FECHAS DE PAGO* (Datos requeridos para continuar) ")]):e._e()],1),e._l(Number(e.nro_cuotas),(function(t){return a(n["a"],{key:t,attrs:{cols:12/e.nro_cuotas}},[a(p["a"],[a(n["a"],{attrs:{cols:"6"}},[e.nuevoExpediente?a(E["a"],{attrs:{label:"Porcentaje Cuota-"+t,type:"number",suffix:"%",dense:""},model:{value:e.cuota[t-1],callback:function(a){e.$set(e.cuota,t-1,a)},expression:"cuota[n - 1]"}}):e._e()],1),a(n["a"],{attrs:{cols:"6"}},[e.nuevoExpediente?a(E["a"],{attrs:{label:"Fecha de pago "+t,type:"date",dense:""},model:{value:e.fechacuota[t-1],callback:function(a){e.$set(e.fechacuota,t-1,a)},expression:"fechacuota[n - 1]"}}):e._e()],1)],1)],1)}))],2)],1),a(p["a"],[a(n["a"],{attrs:{cols:"12"}},[a("center",[a("h3",[e._v("Listado de Datos Obtenidos")])])],1),a(n["a"],{attrs:{cols:"12"}},[a(c["a"],{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.datos,"pagination.sync":"pagination","item-key":"index",loading:e.datos.length!=e.files.length}})],1),a(n["a"],{attrs:{cols:"12"}},[a(f["a"]),e.datos.length>0?a(r["a"],{attrs:{color:"success"},on:{click:function(a){return e.generarControlesGastos()}}},[e._v("Generar")]):e._e()],1)],1),a(d["a"],{attrs:{"max-width":"50%",height:"80%",persistent:""},model:{value:e.dialog,callback:function(a){e.dialog=a},expression:"dialog"}},[[a(i["a"],{attrs:{color:"basil"}},[a(s["d"],{staticClass:"text-center justify-center py-6"},[a("h1",{staticClass:"font-weight-bold text-h2 basil--text"},[e._v("SUBIR ARCHIVOS")])]),a(g["a"],{attrs:{"background-color":"transparent",color:"basil",grow:""},model:{value:e.tab,callback:function(a){e.tab=a},expression:"tab"}},[a(b["a"],{attrs:{loading:e.loadingArras}},[e._v(" Cargar Archivos ")])],1),a(x["a"],{model:{value:e.tab,callback:function(a){e.tab=a},expression:"tab"}},[a(v["a"],[a(i["a"],{attrs:{color:"basil",flat:""}},[a(s["c"],[e.loading?a("div",[a(i["a"],{attrs:{color:"primary",dark:""}},[a(s["c"],[e._v(" Se está analizando los archivos, un momento por favor.... "),a(m["a"],{staticClass:"mb-0",attrs:{indeterminate:"",color:"white"}})],1)],1)],1):a("div",{staticClass:"drop-area",on:{dragover:function(e){e.preventDefault()},drop:e.handleDrop,click:e.openFileInput}},[a("label",[e._v(" Arrastra y suelta archivos aquí "),a(u["a"],{ref:"fileInput",staticStyle:{display:"none"},attrs:{"hide-details":"",multiple:""},on:{change:function(a){return e.Procesar()}},model:{value:e.files,callback:function(a){e.files=a},expression:"files"}})],1)])])],1)],1)],1)],1)]],2)],1)},C=[],y=(t("14d9"),t("e9f5"),t("7d54"),t("8134")),w=t("2f62"),D=t("3d20"),N=t.n(D),$={data(){return{tab:null,dialog:!1,loading:!1,id_exp:null,nuevoExpediente:!1,loadingArras:!0,companiaflag:!1,nroexp:"",nombrecampania:"",files:[],filesErrorExtension:[],filesErrorCampanias:[],filesErrorTelefono:[],filesErrorNombre:[],datos:[],nro_cuotas:3,cuota:[],fechacuota:[],headers:[{text:"Nombres",value:"nombres"},{text:"Apellidos Paterno",value:"apaterno"},{text:"Apellido  Materno",value:"amaterno"},{text:"Teléfono",value:"telefono"},{text:"Teléfono 2",value:"telefono2"},{text:"Monto ($)",value:"monto"},{text:"Pedidos",value:"pedidos"},{text:"Nombre del documento",value:"document"}]}},async mounted(){let e=this;N.a.fire({icon:"question",text:"¿Desea crear un nuevo expediente?",showConfirmButton:!0,showDenyButton:!0,confirmButtonText:"Crear un nuevo expediente",denyButtonText:"Seleccionar un expediente",confirmButtonColor:"#1A237E",denyButtonColor:"#004D40",allowOutsideClick:!1,showCloseButton:!0,timer:null}).then(async a=>{a.isConfirmed&&(e.nuevoExpediente=!0),a.isDenied&&(e.nuevoExpediente=!1,e.$store.state.spiner=!0,await e._getMasterList(),e.$store.state.spiner=!1)})},methods:{...Object(w["b"])(["_getMasterList","CargaMasivaControlDeGastos","createCarpetaOneDrive","actualizarMaster","getNombreCompania","DescargarConsolidadoCargaMasiva"]),addCol(){},openFileInput(){this.$refs.fileInput.$el.click()},subirarchivoflag(){let e=!1;0!=this.nuevoExpediente||this.id_exp&&this.nombrecampania||(e=!0),1!=this.nuevoExpediente||this.nombrecampania||(e=!0);for(let a=0;a<this.nro_cuotas;a++)!this.cuota[a]&&this.nuevoExpediente&&(e=!0),!this.fechacuota[a]&&this.nuevoExpediente&&(e=!0);return e},async nombreCampania(){this.$store.state.spiner=!0,this.nombrecampania=await this.getNombreCompania(this.id_exp).catch(e=>console.log(e)),this.nombrecampania&&(this.companiaflag=!0),this.$store.state.spiner=!1},nuevoExpedienteFlag(){return 1!=this.nuevoExpediente},abrirDialog(){this.files=[],this.tab=null,this.dialog=!this.dialog},async validarExtensionDocumento(){let e=this,a=!0;const t=Array.from(e.files);return t.forEach((t,o)=>{let r=t.name.split("."),i=r[r.length-1];return"xlsx"!=i&&(e.filesErrorExtension.push(`Archivo N° ${o+1}, Nombre: ${t.name}`),a=!1),a}),a},async validarCampania(){this.filesErrorCampanias=[];let e=!0,a=this,t=0;const o=Array.from(a.files);return o.forEach(async(o,r)=>{await Object(y["a"])(o).then(i=>{0==t&&(t=i.length),0!=t&&t!=i.length&&(e=!1,a.filesErrorCampanias.push(`Archivo N° ${r+1}, Nombre: ${o.name}`))}).catch(e=>{console.error("Error al procesar el archivo:",e)})}),e},validarHayTelefonoYHayNombre(){let e=this;e.filesErrorTelefono=[];let a=!0;const t=Array.from(e.files);return t.forEach(async(t,o)=>{await Object(y["a"])(t).then(r=>{for(let i=0;i<r.length;i++)5==i&&(r[i][2]||(e.filesErrorTelefono.push(`Archivo N° ${o+1}, Nombre: ${t.name}`),a=!1)),4==i&&(r[i][2]||(e.filesErrorNombre.push(`Archivo N° ${o+1}, Nombre: ${t.name}`),a=!1))}).catch(e=>{console.error("Error al procesar el archivo:",e)})}),a},async procesarExcel(){let e={validacion:!0,html:""};this.datos=[];let a="",t=await this.validarExtensionDocumento().then(e=>e);if(t){let e=await this.validarCampania().then(e=>e);if(e){let e=await this.validarHayTelefonoYHayNombre();e||(a=`El(los) archivos: <br> "${this.filesErrorTelefono.join("<br>")}" <br> No Contiene número telefónico  . Verifique`)}else a=`El(los) archivos: <br> "${this.filesErrorCampanias.join("<br>")}" <br> No son la misma campaña que el primer archivo. Verifique`}else a=`El(los) archivos: <br>  "${this.filesErrorExtension.join("<br> ")}"<br>  No cumplen con el tipo de documento valido. Verifique`;return e=a?{validacion:!1,html:a}:{validacion:!0,html:a}},async guardarDatosEnTabla(){const e=Array.from(this.files);return await e.forEach(async e=>{await Object(y["a"])(e).then(async a=>{await this.procesarDatos({item:a,name:e.name})}).catch(e=>{console.error("Error al procesar el archivo:",e)})}),!0},async procesarDatos({item:e,name:a}){let t={document:a},o=null,r=null;for(let i=0;i<e.length;i++)if(i>0){if(4==i){let a=e[i][2].split(" ");t.nombres=a[0],t.apaterno=a.length>1?a[1]:"",t.amaterno=a.length>2?a[2]:""}if(5==i){let a=await this.obtenerTelefono(e[i][2]);t.telefono=a[0],t.telefono2=a.length>1?a[1]:""}if(6==i)for(let a=0;a<e[i].length;a++)"MONTO"===e[i][a]&&(o=a);if(6==i)for(let a=0;a<e[i].length;a++)"PEDIDOS"===e[i][a]&&(r=a);7==i&&(t.monto=isNaN(e[i][o])?0:parseFloat(e[i][o]).toFixed(2)),7==i&&(t.pedidos=parseFloat(e[i][r]))}this.datos.push(t)},obtenerTelefono(e){e=e.toString();const a=/\s*[\/,;\\]\s*/;if(a.test(e)){let t=e.split(a);return t}{const a=[];return a.push(e),a}},async handleDrop(e){e.preventDefault(),this.loadingArras=!0,this.loading=!0,this.files=e.dataTransfer.files;let a=await this.procesarExcel().then(e=>e);1==a.validacion&&await this.guardarDatosEnTabla().then(e=>e),0==a.validacion&&N.a.fire({icon:"error",html:a.html}),this.loading=!1,this.loadingArras=!1,this.dialog=!this.dialog},async Procesar(){this.loading=!0;let e=await this.procesarExcel().then(e=>e);1==e.validacion&&await this.guardarDatosEnTabla().then(e=>e),0==e.validacion&&N.a.fire({icon:"error",html:e.html}),this.loading=!1,this.dialog=!this.dialog},validarRegistro(){let e=0,a=!0;for(let t=0;t<this.nro_cuotas;t++)e+=parseFloat(this.cuota[t]);return 100!=e&&this.nuevoExpediente&&(N.a.fire({icon:"error",html:"El porcentaje final debe ser igual al 100%"}),a=!1),a},async generarControlesGastos(){if(this.validarRegistro()){let e=[];for(let o=0;o<this.nro_cuotas;o++)e.push({porcentaje:this.cuota[o],fecha:this.fechacuota[o]});let a={id_master:1==this.nuevoExpediente?"":this.id_exp,id_operador:JSON.parse(sessionStorage.getItem("dataUser"))[0].id,id_branch:JSON.parse(sessionStorage.getItem("dataUser"))[0].id_branch,nombrecampania:this.nombrecampania,cuotas:e,nro_cuotas:this.nro_cuotas,detalle:this.datos,nuevo:this.nuevoExpediente};this.$store.state.spiner=!0;let t=await this.CargaMasivaControlDeGastos(a);if(1==t[0].esnuevoflag){let e=JSON.parse(sessionStorage.getItem("dataUser"))[0].id_branch,a=[1,2];if(a.includes(e)){let e=await this.createCarpetaOneDrive({name:t[0].nro_master});await this.actualizarMaster({id:t[0].id_master,url:e})}}this.$store.state.spiner=!1,N.a.fire({icon:"success",text:1==t[0].esnuevoflag?"Se ha registrado el master con el código "+t[0].nro_master:"Actualización Correcta",confirmButtonText:"Descargar Reporte",denyButtonText:"Ir A Editar el Master",showDenyButton:!0,showCancelButton:!0,cancelButtonText:"Ir la control de gasto",allowOutsideClick:!1}).then(async e=>{e.isConfirmed&&await this.DescargarConsolidadoCargaMasiva(t[0].id_master),e.isDenied&&this.$router.push({name:"controlMasterId",params:{id:t[0].id_master}}),e.isDismissed&&this.$router.push({name:"editControlGasto",params:{id:t[0].id_master,id_branch:JSON.parse(sessionStorage.getItem("dataUser"))[0].id_branch}})})}}}},A=$,k=(t("6dc3"),t("2877")),T=Object(k["a"])(A,_,C,!1,null,"0748ed1a",null);a["default"]=T.exports}}]);